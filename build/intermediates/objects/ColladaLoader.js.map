{"version":3,"sources":["../../../game/objects/ColladaLoader.js"],"names":["THREE","require","ColladaLoader","COLLADA","scene","visualScene","kinematicsModel","readyCallbackFunc","sources","images","animations","controllers","geometries","materials","effects","cameras","lights","animData","kinematics","visualScenes","kinematicsModels","baseUrl","morphs","skins","flip_uv","preferredShading","SmoothShading","options","centerGeometry","convertUpAxis","subdivideFaces","upAxis","defaultEnvMap","colladaUnit","colladaUp","upConversion","load","url","readyCallback","progressCallback","failCallback","length","document","implementation","createDocument","request","XMLHttpRequest","onreadystatechange","readyState","status","response","parse","undefined","type","console","error","getResponseHeader","total","loaded","responseText","open","send","alert","text","callBack","DOMParser","parseFromString","parts","split","pop","join","parseAsset","setUpConversion","parseLib","_Image","Material","Effect","Geometry","Camera","Light","Controller","Animation","VisualScene","KinematicsModel","parseScene","Group","i","nodes","add","createSceneGraph","scale","multiplyScalar","createAnimations","parseKinematicsModel","createKinematics","result","dae","setPreferredShading","shading","elements","querySelectorAll","element","childNodes","child","nodeName","meter","getAttribute","parseFloat","textContent","charAt","q","classSpec","prefix","lib","elementsLength","j","daeElement","id","sceneElement","replace","kinematicsModelElement","recurseHierarchy","node","n","getChildById","colladaId","newData","keys","fps","hierarchy","sids","name","push","il","Math","max","time","children","d","jl","calcAnimationBounds","start","end","frames","ID","animation","sampler","create","min","startTime","endTime","input","createMorph","geometry","ctrl","morphCtrl","InstanceController","morph","log","targets","target_id","daeGeometry","mesh","primitives","target","vertices","morphTargets","createSkin","applyBindShape","skinCtrl","skin","skeleton","bones","skinWeights","skinIndices","applyMatrix4","bindShapeMatrix","setupSkeleton","frame","parent","world","Matrix4","localworld","copy","matrix","channels","channel","m","output","multiplyMatrices","setupSkinningMatrices","bone","found","joints","sid","inv","invBindMatrices","invBindMatrix","skinningMatrix","animatrix","weights","k","w","joint","warn","flattenSkeleton","list","walk","parentid","data","Vector3","Quaternion","decompose","pos","x","y","z","scl","rotq","skinToBindPose","skinController","v","skinned","vidx","index","weight","o","s","applySkin","instanceCtrl","animationBounds","getChildBySid","bonelist","sortedbones","indicies","Vector4","animationdata","key","rot","jointMap","_addToMap","jointIndex","parentVisualElement","parentVisualElementId","colladaNode","traverse","transforms","position","zeroPosition","getJointValue","jointData","setJointValue","value","limits","static","threejsNode","axis","transform","indexOf","multiply","m1","makeRotationAxis","degToRad","makeTranslation","obj","angle","elementsFloat32Arr","Array","prototype","slice","call","elementsRowMajor","set","apply","quaternion","querySelector","nodeType","visualTarget","parseInt","visualTargetElement","parentElement","Object3D","morphController","controller","source","inst_geom","InstanceGeometry","instance_material","second","double_sided_materials","instance_geometry","instance_materials","used_materials","used_materials_array","num_materials","first_material","mat","effect_id","instance_effect","shader","material3js","material","doubleSided","symbol","_copied_material","clone","side","DoubleSide","opacity","MeshLambertMaterial","color","FrontSide","geom","geometry3js","MultiMaterial","faces","face","materialIndex","daeMaterial","skinning","SkinnedMesh","Mesh","isLineStrip","Line","instance_camera","cparams","cam","PerspectiveCamera","yfov","aspect_ratio","znear","zfar","light","instance_light","lparams","technique","getHex","intensity","distance","falloff_angle","DirectionalLight","PointLight","SpotLight","AmbientLight","layer","delta","center","applyQuaternion","sub","getJointId","getLibraryNode","attObj","attributes","getNamedItem","getChannelsForNode","calcFrameDuration","minT","t0","t1","calcMatrixAt","t","animated","bakeAnimations","fullSid","getTransformBySid","member","arrIndices","getConvertedIndex","getConvertedMember","getData","findKey","Key","timeNdx","findTimeNdx","splice","addTarget","hasTarget","interpolateKeys","retVal","ndx","prevKey","getPrevKeyWith","nextKey","getNextKeyWith","prevTarget","getTarget","nextData","prevData","init_from","Skin","Morph","method","inputs","Source","parseInputs","semantic","read","Input","f","_floats","getConvertedMat4","src","parseJoints","parseWeights","vcount","_ints","numBones","vertex_weights","influence","offset","recursive","Node","getChannelForTransform","transformSid","shift","dotSyntax","arrSyntax","info","InstanceCamera","InstanceLight","iNode","Transform","updateMatrix","identity","convert","fixCoords","update","members","n11","n21","n31","n41","n12","n22","n32","n42","n13","n23","n33","n43","n14","n24","n34","n44","propName","Object","toString","instances","instance","InstanceMaterial","extractDoubleSided","_source","Vertices","LineStrips","Triangles","Polygons","Polylist","vertexData","getConvertedVec3","primitive","setVertices","handlePrimitive","calcNormals","computeVertexNormals","pList","p","idx32","numParams","vcIndex","maxOffset","texture_sets","pCount","vs","ns","ts","cs","accessor","params","Vector2","Color","setRGB","NORMAL","len","TEXCOORD","COLOR","uv","uvArr","Face3","clr","vec1","vec2","vec3","v1","v2","norm","faceVertexUvs","count","_attr_as_int","constructor","Accessor","stride","param","_bools","_strings","InstanceEffect","ColorOrTexture","random","a","texture","texcoord","texOpts","isColor","isTexture","opaque","rgba","offsetU","offsetV","repeatU","repeatV","wrapU","wrapV","parseTexture","toUpperCase","Shader","effect","bumpType","toLowerCase","props","transparent","transparentColor","transparencyLevel","r","g","b","transparency","prop","cot","samplerId","surfaceId","surface","image","loader","Loader","Handlers","get","Texture","loadTextureImage","wrapS","RepeatWrapping","ClampToEdgeWrapping","wrapT","repeat","MixOperation","diffuse","emissive","MeshBasicMaterial","MeshPhongMaterial","Surface","format","Sampler2D","wrap_s","wrap_t","minfilter","magfilter","mipfilter","parseTechnique","parseProfileCOMMON","parseNewparam","_image","parseExtra","parseExtraTechnique","anim","Sampler","Channel","strideOut","interpolation","duration","getConvertedTranslation","opt_sid","interpolate","l","nextTarget","parseOptics","perspective","xfov","orthographic","xmag","ymag","parseCommon","sqrt","profile","links","Joint","Link","middlePosition","axisElement","_axis","jointTypes","jointElement","attachments","Attachment","_nsResolver","nsPrefix","str","raw","_trimString","_attr_as_float","defaultValue","hasAttribute","_attr_as_string","_format_float","num","substr","ImageLoader","needsUpdate","sign","tmp","arr","indices","X","Y","Z"],"mappings":"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","file":"ColladaLoader.js","sourcesContent":["/**\n* @author Tim Knip / http://www.floorplanner.com/ / tim at floorplanner.com\n* @author Tony Parisi / http://www.tonyparisi.com/\n*/\n\nvar THREE = require('three');\n\nTHREE.ColladaLoader = function () {\n\n\tvar COLLADA = null;\n\tvar scene = null;\n\tvar visualScene;\n\tvar kinematicsModel;\n\n\tvar readyCallbackFunc = null;\n\n\tvar sources = {};\n\tvar images = {};\n\tvar animations = {};\n\tvar controllers = {};\n\tvar geometries = {};\n\tvar materials = {};\n\tvar effects = {};\n\tvar cameras = {};\n\tvar lights = {};\n\n\tvar animData;\n\tvar kinematics;\n\tvar visualScenes;\n\tvar kinematicsModels;\n\tvar baseUrl;\n\tvar morphs;\n\tvar skins;\n\n\tvar flip_uv = true;\n\tvar preferredShading = THREE.SmoothShading;\n\n\tvar options = {\n\t\t// Force Geometry to always be centered at the local origin of the\n\t\t// containing Mesh.\n\t\tcenterGeometry: false,\n\n\t\t// Axis conversion is done for geometries, animations, and controllers.\n\t\t// If we ever pull cameras or lights out of the COLLADA file, they'll\n\t\t// need extra work.\n\t\tconvertUpAxis: false,\n\n\t\tsubdivideFaces: true,\n\n\t\tupAxis: 'Y',\n\n\t\t// For reflective or refractive materials we'll use this cubemap\n\t\tdefaultEnvMap: null\n\n\t};\n\n\tvar colladaUnit = 1.0;\n\tvar colladaUp = 'Y';\n\tvar upConversion = null;\n\n\tfunction load ( url, readyCallback, progressCallback, failCallback ) {\n\n\t\tvar length = 0;\n\n\t\tif ( document.implementation && document.implementation.createDocument ) {\n\n\t\t\tvar request = new XMLHttpRequest();\n\n\t\t\trequest.onreadystatechange = function() {\n\n\t\t\t\tif ( request.readyState === 4 ) {\n\n\t\t\t\t\tif ( request.status === 0 || request.status === 200 ) {\n\n\t\t\t\t\t\tif ( request.response ) {\n\n\t\t\t\t\t\t\treadyCallbackFunc = readyCallback;\n\t\t\t\t\t\t\tparse( request.response, undefined, url );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( failCallback ) {\n\n\t\t\t\t\t\t\t\tfailCallback( { type: 'error', url: url } );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tconsole.error( \"ColladaLoader: Empty or non-existing file (\" + url + \")\" );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}else{\n\n\t\t\t\t\t\tif( failCallback ){\n\n\t\t\t\t\t\t\tfailCallback( { type: 'error', url: url } );\n\n\t\t\t\t\t\t}else{\n\n\t\t\t\t\t\t\tconsole.error( 'ColladaLoader: Couldn\\'t load \"' + url + '\" (' + request.status + ')' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( request.readyState === 3 ) {\n\n\t\t\t\t\tif ( progressCallback ) {\n\n\t\t\t\t\t\tif ( length === 0 ) {\n\n\t\t\t\t\t\t\tlength = request.getResponseHeader( \"Content-Length\" );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tprogressCallback( { total: length, loaded: request.responseText.length } );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\trequest.open( \"GET\", url, true );\n\t\t\trequest.send( null );\n\n\t\t} else {\n\n\t\t\talert( \"Don't know how to parse XML!\" );\n\n\t\t}\n\n\t}\n\n\tfunction parse( text, callBack, url ) {\n\n\t\tCOLLADA = new DOMParser().parseFromString( text, 'text/xml' );\n\t\tcallBack = callBack || readyCallbackFunc;\n\n\t\tif ( url !== undefined ) {\n\n\t\t\tvar parts = url.split( '/' );\n\t\t\tparts.pop();\n\t\t\tbaseUrl = ( parts.length < 1 ? '.' : parts.join( '/' ) ) + '/';\n\n\t\t}\n\n\t\tparseAsset();\n\t\tsetUpConversion();\n\t\timages = parseLib( \"library_images image\", _Image, \"image\" );\n\t\tmaterials = parseLib( \"library_materials material\", Material, \"material\" );\n\t\teffects = parseLib( \"library_effects effect\", Effect, \"effect\" );\n\t\tgeometries = parseLib( \"library_geometries geometry\", Geometry, \"geometry\" );\n\t\tcameras = parseLib( \"library_cameras camera\", Camera, \"camera\" );\n\t\tlights = parseLib( \"library_lights light\", Light, \"light\" );\n\t\tcontrollers = parseLib( \"library_controllers controller\", Controller, \"controller\" );\n\t\tanimations = parseLib( \"library_animations animation\", Animation, \"animation\" );\n\t\tvisualScenes = parseLib( \"library_visual_scenes visual_scene\", VisualScene, \"visual_scene\" );\n\t\tkinematicsModels = parseLib( \"library_kinematics_models kinematics_model\", KinematicsModel, \"kinematics_model\" );\n\n\t\tmorphs = [];\n\t\tskins = [];\n\n\t\tvisualScene = parseScene();\n\t\tscene = new THREE.Group();\n\n\t\tfor ( var i = 0; i < visualScene.nodes.length; i ++ ) {\n\n\t\t\tscene.add( createSceneGraph( visualScene.nodes[ i ] ) );\n\n\t\t}\n\n\t\t// unit conversion\n\t\tscene.scale.multiplyScalar( colladaUnit );\n\n\t\tcreateAnimations();\n\n\t\tkinematicsModel = parseKinematicsModel();\n\t\tcreateKinematics();\n\n\t\tvar result = {\n\n\t\t\tscene: scene,\n\t\t\tmorphs: morphs,\n\t\t\tskins: skins,\n\t\t\tanimations: animData,\n\t\t\tkinematics: kinematics,\n\t\t\tdae: {\n\t\t\t\timages: images,\n\t\t\t\tmaterials: materials,\n\t\t\t\tcameras: cameras,\n\t\t\t\tlights: lights,\n\t\t\t\teffects: effects,\n\t\t\t\tgeometries: geometries,\n\t\t\t\tcontrollers: controllers,\n\t\t\t\tanimations: animations,\n\t\t\t\tvisualScenes: visualScenes,\n\t\t\t\tvisualScene: visualScene,\n\t\t\t\tscene: visualScene,\n\t\t\t\tkinematicsModels: kinematicsModels,\n\t\t\t\tkinematicsModel: kinematicsModel\n\t\t\t}\n\n\t\t};\n\n\t\tif ( callBack ) {\n\n\t\t\tcallBack( result );\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tfunction setPreferredShading ( shading ) {\n\n\t\tpreferredShading = shading;\n\n\t}\n\n\tfunction parseAsset () {\n\n\t\tvar elements = COLLADA.querySelectorAll('asset');\n\n\t\tvar element = elements[0];\n\n\t\tif ( element && element.childNodes ) {\n\n\t\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'unit':\n\n\t\t\t\t\t\tvar meter = child.getAttribute( 'meter' );\n\n\t\t\t\t\t\tif ( meter ) {\n\n\t\t\t\t\t\t\tcolladaUnit = parseFloat( meter );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'up_axis':\n\n\t\t\t\t\t\tcolladaUp = child.textContent.charAt(0);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction parseLib ( q, classSpec, prefix ) {\n\n\t\tvar elements = COLLADA.querySelectorAll(q);\n\n\t\tvar lib = {};\n\n\t\tvar i = 0;\n\n\t\tvar elementsLength = elements.length;\n\n\t\tfor ( var j = 0; j < elementsLength; j ++ ) {\n\n\t\t\tvar element = elements[j];\n\t\t\tvar daeElement = ( new classSpec() ).parse( element );\n\n\t\t\tif ( !daeElement.id || daeElement.id.length === 0 ) daeElement.id = prefix + ( i ++ );\n\t\t\tlib[ daeElement.id ] = daeElement;\n\n\t\t}\n\n\t\treturn lib;\n\n\t}\n\n\tfunction parseScene() {\n\n\t\tvar sceneElement = COLLADA.querySelectorAll('scene instance_visual_scene')[0];\n\n\t\tif ( sceneElement ) {\n\n\t\t\tvar url = sceneElement.getAttribute( 'url' ).replace( /^#/, '' );\n\t\t\treturn visualScenes[ url.length > 0 ? url : 'visual_scene0' ];\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n\tfunction parseKinematicsModel() {\n\n\t\tvar kinematicsModelElement = COLLADA.querySelectorAll('instance_kinematics_model')[0];\n\n\t\tif ( kinematicsModelElement ) {\n\n\t\t\tvar url = kinematicsModelElement.getAttribute( 'url' ).replace(/^#/, '');\n\t\t\treturn kinematicsModels[ url.length > 0 ? url : 'kinematics_model0' ];\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n\tfunction createAnimations() {\n\n\t\tanimData = [];\n\n\t\t// fill in the keys\n\t\trecurseHierarchy( scene );\n\n\t}\n\n\tfunction recurseHierarchy( node ) {\n\n\t\tvar n = visualScene.getChildById( node.colladaId, true ),\n\t\t\tnewData = null;\n\n\t\tif ( n && n.keys ) {\n\n\t\t\tnewData = {\n\t\t\t\tfps: 60,\n\t\t\t\thierarchy: [ {\n\t\t\t\t\tnode: n,\n\t\t\t\t\tkeys: n.keys,\n\t\t\t\t\tsids: n.sids\n\t\t\t\t} ],\n\t\t\t\tnode: node,\n\t\t\t\tname: 'animation_' + node.name,\n\t\t\t\tlength: 0\n\t\t\t};\n\n\t\t\tanimData.push(newData);\n\n\t\t\tfor ( var i = 0, il = n.keys.length; i < il; i ++ ) {\n\n\t\t\t\tnewData.length = Math.max( newData.length, n.keys[i].time );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tnewData = {\n\t\t\t\thierarchy: [ {\n\t\t\t\t\tkeys: [],\n\t\t\t\t\tsids: []\n\t\t\t\t} ]\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var i = 0, il = node.children.length; i < il; i ++ ) {\n\n\t\t\tvar d = recurseHierarchy( node.children[i] );\n\n\t\t\tfor ( var j = 0, jl = d.hierarchy.length; j < jl; j ++ ) {\n\n\t\t\t\tnewData.hierarchy.push( {\n\t\t\t\t\tkeys: [],\n\t\t\t\t\tsids: []\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn newData;\n\n\t}\n\n\tfunction calcAnimationBounds () {\n\n\t\tvar start = 1000000;\n\t\tvar end = -start;\n\t\tvar frames = 0;\n\t\tvar ID;\n\t\tfor ( var id in animations ) {\n\n\t\t\tvar animation = animations[ id ];\n\t\t\tID = ID || animation.id;\n\t\t\tfor ( var i = 0; i < animation.sampler.length; i ++ ) {\n\n\t\t\t\tvar sampler = animation.sampler[ i ];\n\n\t\t\t\tsampler.create();\n\n\t\t\t\tstart = Math.min( start, sampler.startTime );\n\t\t\t\tend = Math.max( end, sampler.endTime );\n\t\t\t\tframes = Math.max( frames, sampler.input.length );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn { start:start, end:end, frames:frames,ID:ID };\n\n\t}\n\n\tfunction createMorph ( geometry, ctrl ) {\n\n\t\tvar morphCtrl = ctrl instanceof InstanceController ? controllers[ ctrl.url ] : ctrl;\n\n\t\tif ( !morphCtrl || !morphCtrl.morph ) {\n\n\t\t\tconsole.log(\"could not find morph controller!\");\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar morph = morphCtrl.morph;\n\n\t\tfor ( var i = 0; i < morph.targets.length; i ++ ) {\n\n\t\t\tvar target_id = morph.targets[ i ];\n\t\t\tvar daeGeometry = geometries[ target_id ];\n\n\t\t\tif ( !daeGeometry.mesh ||\n\t\t\t\t !daeGeometry.mesh.primitives ||\n\t\t\t\t !daeGeometry.mesh.primitives.length ) {\n\t\t\t\t continue;\n\t\t\t}\n\n\t\t\tvar target = daeGeometry.mesh.primitives[ 0 ].geometry;\n\n\t\t\tif ( target.vertices.length === geometry.vertices.length ) {\n\n\t\t\t\tgeometry.morphTargets.push( { name: \"target_1\", vertices: target.vertices } );\n\n\t\t\t}\n\n\t\t}\n\n\t\tgeometry.morphTargets.push( { name: \"target_Z\", vertices: geometry.vertices } );\n\n\t}\n\n\tfunction createSkin ( geometry, ctrl, applyBindShape ) {\n\n\t\tvar skinCtrl = controllers[ ctrl.url ];\n\n\t\tif ( !skinCtrl || !skinCtrl.skin ) {\n\n\t\t\tconsole.log( \"could not find skin controller!\" );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( !ctrl.skeleton || !ctrl.skeleton.length ) {\n\n\t\t\tconsole.log( \"could not find the skeleton for the skin!\" );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar skin = skinCtrl.skin;\n\t\tvar skeleton = visualScene.getChildById( ctrl.skeleton[ 0 ] );\n\t\tvar hierarchy = [];\n\n\t\tapplyBindShape = applyBindShape !== undefined ? applyBindShape : true;\n\n\t\tvar bones = [];\n\t\tgeometry.skinWeights = [];\n\t\tgeometry.skinIndices = [];\n\n\t\t//createBones( geometry.bones, skin, hierarchy, skeleton, null, -1 );\n\t\t//createWeights( skin, geometry.bones, geometry.skinIndices, geometry.skinWeights );\n\n\t\t/*\n\t\tgeometry.animation = {\n\t\t\tname: 'take_001',\n\t\t\tfps: 30,\n\t\t\tlength: 2,\n\t\t\tJIT: true,\n\t\t\thierarchy: hierarchy\n\t\t};\n\t\t*/\n\n\t\tif ( applyBindShape ) {\n\n\t\t\tfor ( var i = 0; i < geometry.vertices.length; i ++ ) {\n\n\t\t\t\tgeometry.vertices[ i ].applyMatrix4( skin.bindShapeMatrix );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction setupSkeleton ( node, bones, frame, parent ) {\n\n\t\tnode.world = node.world || new THREE.Matrix4();\n\t\tnode.localworld = node.localworld || new THREE.Matrix4();\n\t\tnode.world.copy( node.matrix );\n\t\tnode.localworld.copy( node.matrix );\n\n\t\tif ( node.channels && node.channels.length ) {\n\n\t\t\tvar channel = node.channels[ 0 ];\n\t\t\tvar m = channel.sampler.output[ frame ];\n\n\t\t\tif ( m instanceof THREE.Matrix4 ) {\n\n\t\t\t\tnode.world.copy( m );\n\t\t\t\tnode.localworld.copy(m);\n\t\t\t\tif (frame === 0)\n\t\t\t\t\tnode.matrix.copy(m);\n\t\t\t}\n\n\t\t}\n\n\t\tif ( parent ) {\n\n\t\t\tnode.world.multiplyMatrices( parent, node.world );\n\n\t\t}\n\n\t\tbones.push( node );\n\n\t\tfor ( var i = 0; i < node.nodes.length; i ++ ) {\n\n\t\t\tsetupSkeleton( node.nodes[ i ], bones, frame, node.world );\n\n\t\t}\n\n\t}\n\n\tfunction setupSkinningMatrices ( bones, skin ) {\n\n\t\t// FIXME: this is dumb...\n\n\t\tfor ( var i = 0; i < bones.length; i ++ ) {\n\n\t\t\tvar bone = bones[ i ];\n\t\t\tvar found = -1;\n\n\t\t\tif ( bone.type != 'JOINT' ) continue;\n\n\t\t\tfor ( var j = 0; j < skin.joints.length; j ++ ) {\n\n\t\t\t\tif ( bone.sid === skin.joints[ j ] ) {\n\n\t\t\t\t\tfound = j;\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( found >= 0 ) {\n\n\t\t\t\tvar inv = skin.invBindMatrices[ found ];\n\n\t\t\t\tbone.invBindMatrix = inv;\n\t\t\t\tbone.skinningMatrix = new THREE.Matrix4();\n\t\t\t\tbone.skinningMatrix.multiplyMatrices(bone.world, inv); // (IBMi * JMi)\n\t\t\t\tbone.animatrix = new THREE.Matrix4();\n\n\t\t\t\tbone.animatrix.copy(bone.localworld);\n\t\t\t\tbone.weights = [];\n\n\t\t\t\tfor ( var j = 0; j < skin.weights.length; j ++ ) {\n\n\t\t\t\t\tfor (var k = 0; k < skin.weights[ j ].length; k ++ ) {\n\n\t\t\t\t\t\tvar w = skin.weights[ j ][ k ];\n\n\t\t\t\t\t\tif ( w.joint === found ) {\n\n\t\t\t\t\t\t\tbone.weights.push( w );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( \"ColladaLoader: Could not find joint '\" + bone.sid + \"'.\" );\n\n\t\t\t\tbone.skinningMatrix = new THREE.Matrix4();\n\t\t\t\tbone.weights = [];\n\n\t\t\t}\n\t\t}\n\n\t}\n\n\t//Walk the Collada tree and flatten the bones into a list, extract the position, quat and scale from the matrix\n\tfunction flattenSkeleton(skeleton) {\n\n\t\tvar list = [];\n\t\tvar walk = function(parentid, node, list) {\n\n\t\t\tvar bone = {};\n\t\t\tbone.name = node.sid;\n\t\t\tbone.parent = parentid;\n\t\t\tbone.matrix = node.matrix;\n\t\t\tvar data = [ new THREE.Vector3(),new THREE.Quaternion(),new THREE.Vector3() ];\n\t\t\tbone.matrix.decompose(data[0], data[1], data[2]);\n\n\t\t\tbone.pos = [ data[0].x,data[0].y,data[0].z ];\n\n\t\t\tbone.scl = [ data[2].x,data[2].y,data[2].z ];\n\t\t\tbone.rotq = [ data[1].x,data[1].y,data[1].z,data[1].w ];\n\t\t\tlist.push(bone);\n\n\t\t\tfor (var i in node.nodes) {\n\n\t\t\t\twalk(node.sid, node.nodes[i], list);\n\n\t\t\t}\n\n\t\t};\n\n\t\twalk(-1, skeleton, list);\n\t\treturn list;\n\n\t}\n\n\t//Move the vertices into the pose that is proper for the start of the animation\n\tfunction skinToBindPose(geometry,skeleton,skinController) {\n\n\t\tvar bones = [];\n\t\tsetupSkeleton( skeleton, bones, -1 );\n\t\tsetupSkinningMatrices( bones, skinController.skin );\n\t\tvar v = new THREE.Vector3();\n\t\tvar skinned = [];\n\n\t\tfor (var i = 0; i < geometry.vertices.length; i ++) {\n\n\t\t\tskinned.push(new THREE.Vector3());\n\n\t\t}\n\n\t\tfor ( i = 0; i < bones.length; i ++ ) {\n\n\t\t\tif ( bones[ i ].type != 'JOINT' ) continue;\n\n\t\t\tfor ( var j = 0; j < bones[ i ].weights.length; j ++ ) {\n\n\t\t\t\tvar w = bones[ i ].weights[ j ];\n\t\t\t\tvar vidx = w.index;\n\t\t\t\tvar weight = w.weight;\n\n\t\t\t\tvar o = geometry.vertices[vidx];\n\t\t\t\tvar s = skinned[vidx];\n\n\t\t\t\tv.x = o.x;\n\t\t\t\tv.y = o.y;\n\t\t\t\tv.z = o.z;\n\n\t\t\t\tv.applyMatrix4( bones[i].skinningMatrix );\n\n\t\t\t\ts.x += (v.x * weight);\n\t\t\t\ts.y += (v.y * weight);\n\t\t\t\ts.z += (v.z * weight);\n\t\t\t}\n\n\t\t}\n\n\t\tfor (var i = 0; i < geometry.vertices.length; i ++) {\n\n\t\t\tgeometry.vertices[i] = skinned[i];\n\n\t\t}\n\n\t}\n\n\tfunction applySkin ( geometry, instanceCtrl, frame ) {\n\n\t\tvar skinController = controllers[ instanceCtrl.url ];\n\n\t\tframe = frame !== undefined ? frame : 40;\n\n\t\tif ( !skinController || !skinController.skin ) {\n\n\t\t\tconsole.log( 'ColladaLoader: Could not find skin controller.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( !instanceCtrl.skeleton || !instanceCtrl.skeleton.length ) {\n\n\t\t\tconsole.log( 'ColladaLoader: Could not find the skeleton for the skin. ' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar animationBounds = calcAnimationBounds();\n\t\tvar skeleton = visualScene.getChildById( instanceCtrl.skeleton[0], true ) || visualScene.getChildBySid( instanceCtrl.skeleton[0], true );\n\n\t\t//flatten the skeleton into a list of bones\n\t\tvar bonelist = flattenSkeleton(skeleton);\n\t\tvar joints = skinController.skin.joints;\n\n\t\t//sort that list so that the order reflects the order in the joint list\n\t\tvar sortedbones = [];\n\t\tfor (var i = 0; i < joints.length; i ++) {\n\n\t\t\tfor (var j = 0; j < bonelist.length; j ++) {\n\n\t\t\t\tif (bonelist[j].name === joints[i]) {\n\n\t\t\t\t\tsortedbones[i] = bonelist[j];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t//hook up the parents by index instead of name\n\t\tfor (var i = 0; i < sortedbones.length; i ++) {\n\n\t\t\tfor (var j = 0; j < sortedbones.length; j ++) {\n\n\t\t\t\tif (sortedbones[i].parent === sortedbones[j].name) {\n\n\t\t\t\t\tsortedbones[i].parent = j;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\n\t\tvar i, j, w, vidx, weight;\n\t\tvar v = new THREE.Vector3(), o, s;\n\n\t\t// move vertices to bind shape\n\t\tfor ( i = 0; i < geometry.vertices.length; i ++ ) {\n\t\t\tgeometry.vertices[i].applyMatrix4( skinController.skin.bindShapeMatrix );\n\t\t}\n\n\t\tvar skinIndices = [];\n\t\tvar skinWeights = [];\n\t\tvar weights = skinController.skin.weights;\n\n\t\t// hook up the skin weights\n\t\t// TODO - this might be a good place to choose greatest 4 weights\n\t\tfor ( var i =0; i < weights.length; i ++ ) {\n\n\t\t\tvar indicies = new THREE.Vector4(weights[i][0] ? weights[i][0].joint : 0,weights[i][1] ? weights[i][1].joint : 0,weights[i][2] ? weights[i][2].joint : 0,weights[i][3] ? weights[i][3].joint : 0);\n\t\t\tvar weight = new THREE.Vector4(weights[i][0] ? weights[i][0].weight : 0,weights[i][1] ? weights[i][1].weight : 0,weights[i][2] ? weights[i][2].weight : 0,weights[i][3] ? weights[i][3].weight : 0);\n\n\t\t\tskinIndices.push(indicies);\n\t\t\tskinWeights.push(weight);\n\n\t\t}\n\n\t\tgeometry.skinIndices = skinIndices;\n\t\tgeometry.skinWeights = skinWeights;\n\t\tgeometry.bones = sortedbones;\n\t\t// process animation, or simply pose the rig if no animation\n\n\t\t//create an animation for the animated bones\n\t\t//NOTE: this has no effect when using morphtargets\n\t\tvar animationdata = { \"name\":animationBounds.ID,\"fps\":30,\"length\":animationBounds.frames / 30,\"hierarchy\":[] };\n\n\t\tfor (var j = 0; j < sortedbones.length; j ++) {\n\n\t\t\tanimationdata.hierarchy.push({ parent:sortedbones[j].parent, name:sortedbones[j].name, keys:[] });\n\n\t\t}\n\n\t\tconsole.log( 'ColladaLoader:', animationBounds.ID + ' has ' + sortedbones.length + ' bones.' );\n\n\n\n\t\tskinToBindPose(geometry, skeleton, skinController);\n\n\n\t\tfor ( frame = 0; frame < animationBounds.frames; frame ++ ) {\n\n\t\t\tvar bones = [];\n\t\t\tvar skinned = [];\n\t\t\t// process the frame and setup the rig with a fresh\n\t\t\t// transform, possibly from the bone's animation channel(s)\n\n\t\t\tsetupSkeleton( skeleton, bones, frame );\n\t\t\tsetupSkinningMatrices( bones, skinController.skin );\n\n\t\t\tfor (var i = 0; i < bones.length; i ++) {\n\n\t\t\t\tfor (var j = 0; j < animationdata.hierarchy.length; j ++) {\n\n\t\t\t\t\tif (animationdata.hierarchy[j].name === bones[i].sid) {\n\n\t\t\t\t\t\tvar key = {};\n\t\t\t\t\t\tkey.time = (frame / 30);\n\t\t\t\t\t\tkey.matrix = bones[i].animatrix;\n\n\t\t\t\t\t\tif (frame === 0)\n\t\t\t\t\t\t\tbones[i].matrix = key.matrix;\n\n\t\t\t\t\t\tvar data = [ new THREE.Vector3(),new THREE.Quaternion(),new THREE.Vector3() ];\n\t\t\t\t\t\tkey.matrix.decompose(data[0], data[1], data[2]);\n\n\t\t\t\t\t\tkey.pos = [ data[0].x,data[0].y,data[0].z ];\n\n\t\t\t\t\t\tkey.scl = [ data[2].x,data[2].y,data[2].z ];\n\t\t\t\t\t\tkey.rot = data[1];\n\n\t\t\t\t\t\tanimationdata.hierarchy[j].keys.push(key);\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgeometry.animation = animationdata;\n\n\t\t}\n\n\t}\n\n\tfunction createKinematics() {\n\n\t\tif ( kinematicsModel && kinematicsModel.joints.length === 0 ) {\n\t\t\tkinematics = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tvar jointMap = {};\n\n\t\tvar _addToMap = function( jointIndex, parentVisualElement ) {\n\n\t\t\tvar parentVisualElementId = parentVisualElement.getAttribute( 'id' );\n\t\t\tvar colladaNode = visualScene.getChildById( parentVisualElementId, true );\n\t\t\tvar joint = kinematicsModel.joints[ jointIndex ];\n\n\t\t\tscene.traverse(function( node ) {\n\n\t\t\t\tif ( node.colladaId == parentVisualElementId ) {\n\n\t\t\t\t\tjointMap[ jointIndex ] = {\n\t\t\t\t\t\tnode: node,\n\t\t\t\t\t\ttransforms: colladaNode.transforms,\n\t\t\t\t\t\tjoint: joint,\n\t\t\t\t\t\tposition: joint.zeroPosition\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t};\n\n\t\tkinematics = {\n\n\t\t\tjoints: kinematicsModel && kinematicsModel.joints,\n\n\t\t\tgetJointValue: function( jointIndex ) {\n\n\t\t\t\tvar jointData = jointMap[ jointIndex ];\n\n\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\treturn jointData.position;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.log( 'getJointValue: joint ' + jointIndex + ' doesn\\'t exist' );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetJointValue: function( jointIndex, value ) {\n\n\t\t\t\tvar jointData = jointMap[ jointIndex ];\n\n\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\tvar joint = jointData.joint;\n\n\t\t\t\t\tif ( value > joint.limits.max || value < joint.limits.min ) {\n\n\t\t\t\t\t\tconsole.log( 'setJointValue: joint ' + jointIndex + ' value ' + value + ' outside of limits (min: ' + joint.limits.min + ', max: ' + joint.limits.max + ')' );\n\n\t\t\t\t\t} else if ( joint.static ) {\n\n\t\t\t\t\t\tconsole.log( 'setJointValue: joint ' + jointIndex + ' is static' );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tvar threejsNode = jointData.node;\n\t\t\t\t\t\tvar axis = joint.axis;\n\t\t\t\t\t\tvar transforms = jointData.transforms;\n\n\t\t\t\t\t\tvar matrix = new THREE.Matrix4();\n\n\t\t\t\t\t\tfor (i = 0; i < transforms.length; i ++ ) {\n\n\t\t\t\t\t\t\tvar transform = transforms[ i ];\n\n\t\t\t\t\t\t\t// kinda ghetto joint detection\n\t\t\t\t\t\t\tif ( transform.sid && transform.sid.indexOf( 'joint' + jointIndex ) !== -1 ) {\n\n\t\t\t\t\t\t\t\t// apply actual joint value here\n\t\t\t\t\t\t\t\tswitch ( joint.type ) {\n\n\t\t\t\t\t\t\t\t\tcase 'revolute':\n\n\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m1.makeRotationAxis( axis, THREE.Math.degToRad(value) ) );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'prismatic':\n\n\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m1.makeTranslation(axis.x * value, axis.y * value, axis.z * value ) );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'setJointValue: unknown joint type: ' + joint.type );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tvar m1 = new THREE.Matrix4();\n\n\t\t\t\t\t\t\t\tswitch ( transform.type ) {\n\n\t\t\t\t\t\t\t\t\tcase 'matrix':\n\n\t\t\t\t\t\t\t\t\t\tmatrix.multiply( transform.obj );\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'translate':\n\n\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m1.makeTranslation( transform.obj.x, transform.obj.y, transform.obj.z ) );\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'rotate':\n\n\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m1.makeRotationAxis( transform.obj, transform.angle ) );\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// apply the matrix to the threejs node\n\t\t\t\t\t\tvar elementsFloat32Arr = matrix.elements;\n\t\t\t\t\t\tvar elements = Array.prototype.slice.call( elementsFloat32Arr );\n\n\t\t\t\t\t\tvar elementsRowMajor = [\n\t\t\t\t\t\t\telements[ 0 ],\n\t\t\t\t\t\t\telements[ 4 ],\n\t\t\t\t\t\t\telements[ 8 ],\n\t\t\t\t\t\t\telements[ 12 ],\n\t\t\t\t\t\t\telements[ 1 ],\n\t\t\t\t\t\t\telements[ 5 ],\n\t\t\t\t\t\t\telements[ 9 ],\n\t\t\t\t\t\t\telements[ 13 ],\n\t\t\t\t\t\t\telements[ 2 ],\n\t\t\t\t\t\t\telements[ 6 ],\n\t\t\t\t\t\t\telements[ 10 ],\n\t\t\t\t\t\t\telements[ 14 ],\n\t\t\t\t\t\t\telements[ 3 ],\n\t\t\t\t\t\t\telements[ 7 ],\n\t\t\t\t\t\t\telements[ 11 ],\n\t\t\t\t\t\t\telements[ 15 ]\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tthreejsNode.matrix.set.apply( threejsNode.matrix, elementsRowMajor );\n\t\t\t\t\t\tthreejsNode.matrix.decompose( threejsNode.position, threejsNode.quaternion, threejsNode.scale );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.log( 'setJointValue: joint ' + jointIndex + ' doesn\\'t exist' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\tvar element = COLLADA.querySelector('scene instance_kinematics_scene');\n\n\t\tif ( element ) {\n\n\t\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_joint_axis':\n\n\t\t\t\t\t\tvar visualTarget = child.getAttribute( 'target' ).split( '/' ).pop();\n\t\t\t\t\t\tvar axis = child.querySelector('axis param').textContent;\n\t\t\t\t\t\tvar jointIndex = parseInt( axis.split( 'joint' ).pop().split( '.' )[0] );\n\t\t\t\t\t\tvar visualTargetElement = COLLADA.querySelector( '[sid=\"' + visualTarget + '\"]' );\n\n\t\t\t\t\t\tif ( visualTargetElement ) {\n\t\t\t\t\t\t\tvar parentVisualElement = visualTargetElement.parentElement;\n\t\t\t\t\t\t\t_addToMap(jointIndex, parentVisualElement);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfunction createSceneGraph ( node, parent ) {\n\n\t\tvar obj = new THREE.Object3D();\n\t\tvar skinned = false;\n\t\tvar skinController;\n\t\tvar morphController;\n\t\tvar i, j;\n\n\t\t// FIXME: controllers\n\n\t\tfor ( i = 0; i < node.controllers.length; i ++ ) {\n\n\t\t\tvar controller = controllers[ node.controllers[ i ].url ];\n\n\t\t\tswitch ( controller.type ) {\n\n\t\t\t\tcase 'skin':\n\n\t\t\t\t\tif ( geometries[ controller.skin.source ] ) {\n\n\t\t\t\t\t\tvar inst_geom = new InstanceGeometry();\n\n\t\t\t\t\t\tinst_geom.url = controller.skin.source;\n\t\t\t\t\t\tinst_geom.instance_material = node.controllers[ i ].instance_material;\n\n\t\t\t\t\t\tnode.geometries.push( inst_geom );\n\t\t\t\t\t\tskinned = true;\n\t\t\t\t\t\tskinController = node.controllers[ i ];\n\n\t\t\t\t\t} else if ( controllers[ controller.skin.source ] ) {\n\n\t\t\t\t\t\t// urgh: controller can be chained\n\t\t\t\t\t\t// handle the most basic case...\n\n\t\t\t\t\t\tvar second = controllers[ controller.skin.source ];\n\t\t\t\t\t\tmorphController = second;\n\t\t\t\t\t//\tskinController = node.controllers[i];\n\n\t\t\t\t\t\tif ( second.morph && geometries[ second.morph.source ] ) {\n\n\t\t\t\t\t\t\tvar inst_geom = new InstanceGeometry();\n\n\t\t\t\t\t\t\tinst_geom.url = second.morph.source;\n\t\t\t\t\t\t\tinst_geom.instance_material = node.controllers[ i ].instance_material;\n\n\t\t\t\t\t\t\tnode.geometries.push( inst_geom );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'morph':\n\n\t\t\t\t\tif ( geometries[ controller.morph.source ] ) {\n\n\t\t\t\t\t\tvar inst_geom = new InstanceGeometry();\n\n\t\t\t\t\t\tinst_geom.url = controller.morph.source;\n\t\t\t\t\t\tinst_geom.instance_material = node.controllers[ i ].instance_material;\n\n\t\t\t\t\t\tnode.geometries.push( inst_geom );\n\t\t\t\t\t\tmorphController = node.controllers[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log( 'ColladaLoader: Morph-controller partially supported.' );\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// geometries\n\n\t\tvar double_sided_materials = {};\n\n\t\tfor ( i = 0; i < node.geometries.length; i ++ ) {\n\n\t\t\tvar instance_geometry = node.geometries[i];\n\t\t\tvar instance_materials = instance_geometry.instance_material;\n\t\t\tvar geometry = geometries[ instance_geometry.url ];\n\t\t\tvar used_materials = {};\n\t\t\tvar used_materials_array = [];\n\t\t\tvar num_materials = 0;\n\t\t\tvar first_material;\n\n\t\t\tif ( geometry ) {\n\n\t\t\t\tif ( !geometry.mesh || !geometry.mesh.primitives )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( obj.name.length === 0 ) {\n\n\t\t\t\t\tobj.name = geometry.id;\n\n\t\t\t\t}\n\n\t\t\t\t// collect used fx for this geometry-instance\n\n\t\t\t\tif ( instance_materials ) {\n\n\t\t\t\t\tfor ( j = 0; j < instance_materials.length; j ++ ) {\n\n\t\t\t\t\t\tvar instance_material = instance_materials[ j ];\n\t\t\t\t\t\tvar mat = materials[ instance_material.target ];\n\t\t\t\t\t\tvar effect_id = mat.instance_effect.url;\n\t\t\t\t\t\tvar shader = effects[ effect_id ].shader;\n\t\t\t\t\t\tvar material3js = shader.material;\n\n\t\t\t\t\t\tif ( geometry.doubleSided ) {\n\n\t\t\t\t\t\t\tif ( !( instance_material.symbol in double_sided_materials ) ) {\n\n\t\t\t\t\t\t\t\tvar _copied_material = material3js.clone();\n\t\t\t\t\t\t\t\t_copied_material.side = THREE.DoubleSide;\n\t\t\t\t\t\t\t\tdouble_sided_materials[ instance_material.symbol ] = _copied_material;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tmaterial3js = double_sided_materials[ instance_material.symbol ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmaterial3js.opacity = !material3js.opacity ? 1 : material3js.opacity;\n\t\t\t\t\t\tused_materials[ instance_material.symbol ] = num_materials;\n\t\t\t\t\t\tused_materials_array.push( material3js );\n\t\t\t\t\t\tfirst_material = material3js;\n\t\t\t\t\t\tfirst_material.name = mat.name === null || mat.name === '' ? mat.id : mat.name;\n\t\t\t\t\t\tnum_materials ++;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar mesh;\n\t\t\t\tvar material = first_material || new THREE.MeshLambertMaterial( { color: 0xdddddd, side: geometry.doubleSided ? THREE.DoubleSide : THREE.FrontSide } );\n\t\t\t\tvar geom = geometry.mesh.geometry3js;\n\n\t\t\t\tif ( num_materials > 1 ) {\n\n\t\t\t\t\tmaterial = new THREE.MultiMaterial( used_materials_array );\n\n\t\t\t\t\tfor ( j = 0; j < geom.faces.length; j ++ ) {\n\n\t\t\t\t\t\tvar face = geom.faces[ j ];\n\t\t\t\t\t\tface.materialIndex = used_materials[ face.daeMaterial ]\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( skinController !== undefined ) {\n\n\n\t\t\t\t\tapplySkin( geom, skinController );\n\n\t\t\t\t\tif ( geom.morphTargets.length > 0 ) {\n\n\t\t\t\t\t\tmaterial.morphTargets = true;\n\t\t\t\t\t\tmaterial.skinning = false;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmaterial.morphTargets = false;\n\t\t\t\t\t\tmaterial.skinning = true;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\tmesh = new THREE.SkinnedMesh( geom, material, false );\n\n\n\t\t\t\t\t//mesh.skeleton = skinController.skeleton;\n\t\t\t\t\t//mesh.skinController = controllers[ skinController.url ];\n\t\t\t\t\t//mesh.skinInstanceController = skinController;\n\t\t\t\t\tmesh.name = 'skin_' + skins.length;\n\n\n\n\t\t\t\t\t//mesh.animationHandle.setKey(0);\n\t\t\t\t\tskins.push( mesh );\n\n\t\t\t\t} else if ( morphController !== undefined ) {\n\n\t\t\t\t\tcreateMorph( geom, morphController );\n\n\t\t\t\t\tmaterial.morphTargets = true;\n\n\t\t\t\t\tmesh = new THREE.Mesh( geom, material );\n\t\t\t\t\tmesh.name = 'morph_' + morphs.length;\n\n\t\t\t\t\tmorphs.push( mesh );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( geom.isLineStrip === true ) {\n\n\t\t\t\t\t\tmesh = new THREE.Line( geom );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmesh = new THREE.Mesh( geom, material );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tobj.add(mesh);\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( i = 0; i < node.cameras.length; i ++ ) {\n\n\t\t\tvar instance_camera = node.cameras[i];\n\t\t\tvar cparams = cameras[instance_camera.url];\n\n\t\t\tvar cam = new THREE.PerspectiveCamera(cparams.yfov, parseFloat(cparams.aspect_ratio),\n\t\t\t\t\tparseFloat(cparams.znear), parseFloat(cparams.zfar));\n\n\t\t\tobj.add(cam);\n\t\t}\n\n\t\tfor ( i = 0; i < node.lights.length; i ++ ) {\n\n\t\t\tvar light = null;\n\t\t\tvar instance_light = node.lights[i];\n\t\t\tvar lparams = lights[instance_light.url];\n\n\t\t\tif ( lparams && lparams.technique ) {\n\n\t\t\t\tvar color = lparams.color.getHex();\n\t\t\t\tvar intensity = lparams.intensity;\n\t\t\t\tvar distance = lparams.distance;\n\t\t\t\tvar angle = lparams.falloff_angle;\n\n\t\t\t\tswitch ( lparams.technique ) {\n\n\t\t\t\t\tcase 'directional':\n\n\t\t\t\t\t\tlight = new THREE.DirectionalLight( color, intensity, distance );\n\t\t\t\t\t\tlight.position.set(0, 0, 1);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'point':\n\n\t\t\t\t\t\tlight = new THREE.PointLight( color, intensity, distance );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'spot':\n\n\t\t\t\t\t\tlight = new THREE.SpotLight( color, intensity, distance, angle );\n\t\t\t\t\t\tlight.position.set(0, 0, 1);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'ambient':\n\n\t\t\t\t\t\tlight = new THREE.AmbientLight( color );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (light) {\n\t\t\t\tobj.add(light);\n\t\t\t}\n\t\t}\n\n\t\tobj.name = node.name || node.id || \"\";\n\t\tobj.colladaId = node.id || \"\";\n\t\tobj.layer = node.layer || \"\";\n\t\tobj.matrix = node.matrix;\n\t\tobj.matrix.decompose( obj.position, obj.quaternion, obj.scale );\n\n\t\tif ( options.centerGeometry && obj.geometry ) {\n\n\t\t\tvar delta = obj.geometry.center();\n\t\t\tdelta.multiply( obj.scale );\n\t\t\tdelta.applyQuaternion( obj.quaternion );\n\n\t\t\tobj.position.sub( delta );\n\n\t\t}\n\n\t\tfor ( i = 0; i < node.nodes.length; i ++ ) {\n\n\t\t\tobj.add( createSceneGraph( node.nodes[i], node ) );\n\n\t\t}\n\n\t\treturn obj;\n\n\t}\n\n\tfunction getJointId( skin, id ) {\n\n\t\tfor ( var i = 0; i < skin.joints.length; i ++ ) {\n\n\t\t\tif ( skin.joints[ i ] === id ) {\n\n\t\t\t\treturn i;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction getLibraryNode( id ) {\n\n\t\tvar nodes = COLLADA.querySelectorAll('library_nodes node');\n\n\t\tfor ( var i = 0; i < nodes.length; i++ ) {\n\n\t\t\tvar attObj = nodes[i].attributes.getNamedItem('id');\n\n\t\t\tif ( attObj && attObj.value === id ) {\n\n\t\t\t\treturn nodes[i];\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn undefined;\n\n\t}\n\n\tfunction getChannelsForNode ( node ) {\n\n\t\tvar channels = [];\n\t\tvar startTime = 1000000;\n\t\tvar endTime = -1000000;\n\n\t\tfor ( var id in animations ) {\n\n\t\t\tvar animation = animations[id];\n\n\t\t\tfor ( var i = 0; i < animation.channel.length; i ++ ) {\n\n\t\t\t\tvar channel = animation.channel[i];\n\t\t\t\tvar sampler = animation.sampler[i];\n\t\t\t\tvar id = channel.target.split('/')[0];\n\n\t\t\t\tif ( id == node.id ) {\n\n\t\t\t\t\tsampler.create();\n\t\t\t\t\tchannel.sampler = sampler;\n\t\t\t\t\tstartTime = Math.min(startTime, sampler.startTime);\n\t\t\t\t\tendTime = Math.max(endTime, sampler.endTime);\n\t\t\t\t\tchannels.push(channel);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( channels.length ) {\n\n\t\t\tnode.startTime = startTime;\n\t\t\tnode.endTime = endTime;\n\n\t\t}\n\n\t\treturn channels;\n\n\t}\n\n\tfunction calcFrameDuration( node ) {\n\n\t\tvar minT = 10000000;\n\n\t\tfor ( var i = 0; i < node.channels.length; i ++ ) {\n\n\t\t\tvar sampler = node.channels[i].sampler;\n\n\t\t\tfor ( var j = 0; j < sampler.input.length - 1; j ++ ) {\n\n\t\t\t\tvar t0 = sampler.input[ j ];\n\t\t\t\tvar t1 = sampler.input[ j + 1 ];\n\t\t\t\tminT = Math.min( minT, t1 - t0 );\n\n\t\t\t}\n\t\t}\n\n\t\treturn minT;\n\n\t}\n\n\tfunction calcMatrixAt( node, t ) {\n\n\t\tvar animated = {};\n\n\t\tvar i, j;\n\n\t\tfor ( i = 0; i < node.channels.length; i ++ ) {\n\n\t\t\tvar channel = node.channels[ i ];\n\t\t\tanimated[ channel.sid ] = channel;\n\n\t\t}\n\n\t\tvar matrix = new THREE.Matrix4();\n\n\t\tfor ( i = 0; i < node.transforms.length; i ++ ) {\n\n\t\t\tvar transform = node.transforms[ i ];\n\t\t\tvar channel = animated[ transform.sid ];\n\n\t\t\tif ( channel !== undefined ) {\n\n\t\t\t\tvar sampler = channel.sampler;\n\t\t\t\tvar value;\n\n\t\t\t\tfor ( j = 0; j < sampler.input.length - 1; j ++ ) {\n\n\t\t\t\t\tif ( sampler.input[ j + 1 ] > t ) {\n\n\t\t\t\t\t\tvalue = sampler.output[ j ];\n\t\t\t\t\t\t//console.log(value.flatten)\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( value !== undefined ) {\n\n\t\t\t\t\tif ( value instanceof THREE.Matrix4 ) {\n\n\t\t\t\t\t\tmatrix.multiplyMatrices( matrix, value );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// FIXME: handle other types\n\n\t\t\t\t\t\tmatrix.multiplyMatrices( matrix, transform.matrix );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tmatrix.multiplyMatrices( matrix, transform.matrix );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tmatrix.multiplyMatrices( matrix, transform.matrix );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn matrix;\n\n\t}\n\n\tfunction bakeAnimations ( node ) {\n\n\t\tif ( node.channels && node.channels.length ) {\n\n\t\t\tvar keys = [],\n\t\t\t\tsids = [];\n\n\t\t\tfor ( var i = 0, il = node.channels.length; i < il; i ++ ) {\n\n\t\t\t\tvar channel = node.channels[i],\n\t\t\t\t\tfullSid = channel.fullSid,\n\t\t\t\t\tsampler = channel.sampler,\n\t\t\t\t\tinput = sampler.input,\n\t\t\t\t\ttransform = node.getTransformBySid( channel.sid ),\n\t\t\t\t\tmember;\n\n\t\t\t\tif ( channel.arrIndices ) {\n\n\t\t\t\t\tmember = [];\n\n\t\t\t\t\tfor ( var j = 0, jl = channel.arrIndices.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tmember[ j ] = getConvertedIndex( channel.arrIndices[ j ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tmember = getConvertedMember( channel.member );\n\n\t\t\t\t}\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tif ( sids.indexOf( fullSid ) === -1 ) {\n\n\t\t\t\t\t\tsids.push( fullSid );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var j = 0, jl = input.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tvar time = input[j],\n\t\t\t\t\t\t\tdata = sampler.getData( transform.type, j, member ),\n\t\t\t\t\t\t\tkey = findKey( keys, time );\n\n\t\t\t\t\t\tif ( !key ) {\n\n\t\t\t\t\t\t\tkey = new Key( time );\n\t\t\t\t\t\t\tvar timeNdx = findTimeNdx( keys, time );\n\t\t\t\t\t\t\tkeys.splice( timeNdx === -1 ? keys.length : timeNdx, 0, key );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tkey.addTarget( fullSid, transform, member, data );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.log( 'Could not find transform \"' + channel.sid + '\" in node ' + node.id );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// post process\n\t\t\tfor ( var i = 0; i < sids.length; i ++ ) {\n\n\t\t\t\tvar sid = sids[ i ];\n\n\t\t\t\tfor ( var j = 0; j < keys.length; j ++ ) {\n\n\t\t\t\t\tvar key = keys[ j ];\n\n\t\t\t\t\tif ( !key.hasTarget( sid ) ) {\n\n\t\t\t\t\t\tinterpolateKeys( keys, key, j, sid );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tnode.keys = keys;\n\t\t\tnode.sids = sids;\n\n\t\t}\n\n\t}\n\n\tfunction findKey ( keys, time) {\n\n\t\tvar retVal = null;\n\n\t\tfor ( var i = 0, il = keys.length; i < il && retVal === null; i ++ ) {\n\n\t\t\tvar key = keys[i];\n\n\t\t\tif ( key.time === time ) {\n\n\t\t\t\tretVal = key;\n\n\t\t\t} else if ( key.time > time ) {\n\n\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn retVal;\n\n\t}\n\n\tfunction findTimeNdx ( keys, time) {\n\n\t\tvar ndx = -1;\n\n\t\tfor ( var i = 0, il = keys.length; i < il && ndx === -1; i ++ ) {\n\n\t\t\tvar key = keys[i];\n\n\t\t\tif ( key.time >= time ) {\n\n\t\t\t\tndx = i;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn ndx;\n\n\t}\n\n\tfunction interpolateKeys ( keys, key, ndx, fullSid ) {\n\n\t\tvar prevKey = getPrevKeyWith( keys, fullSid, ndx ? ndx - 1 : 0 ),\n\t\t\tnextKey = getNextKeyWith( keys, fullSid, ndx + 1 );\n\n\t\tif ( prevKey && nextKey ) {\n\n\t\t\tvar scale = (key.time - prevKey.time) / (nextKey.time - prevKey.time),\n\t\t\t\tprevTarget = prevKey.getTarget( fullSid ),\n\t\t\t\tnextData = nextKey.getTarget( fullSid ).data,\n\t\t\t\tprevData = prevTarget.data,\n\t\t\t\tdata;\n\n\t\t\tif ( prevTarget.type === 'matrix' ) {\n\n\t\t\t\tdata = prevData;\n\n\t\t\t} else if ( prevData.length ) {\n\n\t\t\t\tdata = [];\n\n\t\t\t\tfor ( var i = 0; i < prevData.length; ++ i ) {\n\n\t\t\t\t\tdata[ i ] = prevData[ i ] + ( nextData[ i ] - prevData[ i ] ) * scale;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tdata = prevData + ( nextData - prevData ) * scale;\n\n\t\t\t}\n\n\t\t\tkey.addTarget( fullSid, prevTarget.transform, prevTarget.member, data );\n\n\t\t}\n\n\t}\n\n\t// Get next key with given sid\n\n\tfunction getNextKeyWith( keys, fullSid, ndx ) {\n\n\t\tfor ( ; ndx < keys.length; ndx ++ ) {\n\n\t\t\tvar key = keys[ ndx ];\n\n\t\t\tif ( key.hasTarget( fullSid ) ) {\n\n\t\t\t\treturn key;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t// Get previous key with given sid\n\n\tfunction getPrevKeyWith( keys, fullSid, ndx ) {\n\n\t\tndx = ndx >= 0 ? ndx : ndx + keys.length;\n\n\t\tfor ( ; ndx >= 0; ndx -- ) {\n\n\t\t\tvar key = keys[ ndx ];\n\n\t\t\tif ( key.hasTarget( fullSid ) ) {\n\n\t\t\t\treturn key;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\tfunction _Image() {\n\n\t\tthis.id = \"\";\n\t\tthis.init_from = \"\";\n\n\t}\n\n\t_Image.prototype.parse = function(element) {\n\n\t\tthis.id = element.getAttribute('id');\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tif ( child.nodeName === 'init_from' ) {\n\n\t\t\t\tthis.init_from = child.textContent;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Controller() {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.type = \"\";\n\t\tthis.skin = null;\n\t\tthis.morph = null;\n\n\t}\n\n\tController.prototype.parse = function( element ) {\n\n\t\tthis.id = element.getAttribute('id');\n\t\tthis.name = element.getAttribute('name');\n\t\tthis.type = \"none\";\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'skin':\n\n\t\t\t\t\tthis.skin = (new Skin()).parse(child);\n\t\t\t\t\tthis.type = child.nodeName;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'morph':\n\n\t\t\t\t\tthis.morph = (new Morph()).parse(child);\n\t\t\t\t\tthis.type = child.nodeName;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Morph() {\n\n\t\tthis.method = null;\n\t\tthis.source = null;\n\t\tthis.targets = null;\n\t\tthis.weights = null;\n\n\t}\n\n\tMorph.prototype.parse = function( element ) {\n\n\t\tvar sources = {};\n\t\tvar inputs = [];\n\t\tvar i;\n\n\t\tthis.method = element.getAttribute( 'method' );\n\t\tthis.source = element.getAttribute( 'source' ).replace( /^#/, '' );\n\n\t\tfor ( i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'source':\n\n\t\t\t\t\tvar source = ( new Source() ).parse( child );\n\t\t\t\t\tsources[ source.id ] = source;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'targets':\n\n\t\t\t\t\tinputs = this.parseInputs( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( i = 0; i < inputs.length; i ++ ) {\n\n\t\t\tvar input = inputs[ i ];\n\t\t\tvar source = sources[ input.source ];\n\n\t\t\tswitch ( input.semantic ) {\n\n\t\t\t\tcase 'MORPH_TARGET':\n\n\t\t\t\t\tthis.targets = source.read();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'MORPH_WEIGHT':\n\n\t\t\t\t\tthis.weights = source.read();\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tMorph.prototype.parseInputs = function(element) {\n\n\t\tvar inputs = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\t\t\tif ( child.nodeType != 1) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'input':\n\n\t\t\t\t\tinputs.push( (new Input()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn inputs;\n\n\t};\n\n\tfunction Skin() {\n\n\t\tthis.source = \"\";\n\t\tthis.bindShapeMatrix = null;\n\t\tthis.invBindMatrices = [];\n\t\tthis.joints = [];\n\t\tthis.weights = [];\n\n\t}\n\n\tSkin.prototype.parse = function( element ) {\n\n\t\tvar sources = {};\n\t\tvar joints, weights;\n\n\t\tthis.source = element.getAttribute( 'source' ).replace( /^#/, '' );\n\t\tthis.invBindMatrices = [];\n\t\tthis.joints = [];\n\t\tthis.weights = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'bind_shape_matrix':\n\n\t\t\t\t\tvar f = _floats(child.textContent);\n\t\t\t\t\tthis.bindShapeMatrix = getConvertedMat4( f );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'source':\n\n\t\t\t\t\tvar src = new Source().parse(child);\n\t\t\t\t\tsources[ src.id ] = src;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'joints':\n\n\t\t\t\t\tjoints = child;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'vertex_weights':\n\n\t\t\t\t\tweights = child;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\t\t}\n\n\t\tthis.parseJoints( joints, sources );\n\t\tthis.parseWeights( weights, sources );\n\n\t\treturn this;\n\n\t};\n\n\tSkin.prototype.parseJoints = function ( element, sources ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'input':\n\n\t\t\t\t\tvar input = ( new Input() ).parse( child );\n\t\t\t\t\tvar source = sources[ input.source ];\n\n\t\t\t\t\tif ( input.semantic === 'JOINT' ) {\n\n\t\t\t\t\t\tthis.joints = source.read();\n\n\t\t\t\t\t} else if ( input.semantic === 'INV_BIND_MATRIX' ) {\n\n\t\t\t\t\t\tthis.invBindMatrices = source.read();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tSkin.prototype.parseWeights = function ( element, sources ) {\n\n\t\tvar v, vcount, inputs = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'input':\n\n\t\t\t\t\tinputs.push( ( new Input() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'v':\n\n\t\t\t\t\tv = _ints( child.textContent );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'vcount':\n\n\t\t\t\t\tvcount = _ints( child.textContent );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar index = 0;\n\n\t\tfor ( var i = 0; i < vcount.length; i ++ ) {\n\n\t\t\tvar numBones = vcount[i];\n\t\t\tvar vertex_weights = [];\n\n\t\t\tfor ( var j = 0; j < numBones; j ++ ) {\n\n\t\t\t\tvar influence = {};\n\n\t\t\t\tfor ( var k = 0; k < inputs.length; k ++ ) {\n\n\t\t\t\t\tvar input = inputs[ k ];\n\t\t\t\t\tvar value = v[ index + input.offset ];\n\n\t\t\t\t\tswitch ( input.semantic ) {\n\n\t\t\t\t\t\tcase 'JOINT':\n\n\t\t\t\t\t\t\tinfluence.joint = value;//this.joints[value];\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'WEIGHT':\n\n\t\t\t\t\t\t\tinfluence.weight = sources[ input.source ].data[ value ];\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvertex_weights.push( influence );\n\t\t\t\tindex += inputs.length;\n\t\t\t}\n\n\t\t\tfor ( var j = 0; j < vertex_weights.length; j ++ ) {\n\n\t\t\t\tvertex_weights[ j ].index = i;\n\n\t\t\t}\n\n\t\t\tthis.weights.push( vertex_weights );\n\n\t\t}\n\n\t};\n\n\tfunction VisualScene () {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.nodes = [];\n\t\tthis.scene = new THREE.Group();\n\n\t}\n\n\tVisualScene.prototype.getChildById = function( id, recursive ) {\n\n\t\tfor ( var i = 0; i < this.nodes.length; i ++ ) {\n\n\t\t\tvar node = this.nodes[ i ].getChildById( id, recursive );\n\n\t\t\tif ( node ) {\n\n\t\t\t\treturn node;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tVisualScene.prototype.getChildBySid = function( sid, recursive ) {\n\n\t\tfor ( var i = 0; i < this.nodes.length; i ++ ) {\n\n\t\t\tvar node = this.nodes[ i ].getChildBySid( sid, recursive );\n\n\t\t\tif ( node ) {\n\n\t\t\t\treturn node;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tVisualScene.prototype.parse = function( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.name = element.getAttribute( 'name' );\n\t\tthis.nodes = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'node':\n\n\t\t\t\t\tthis.nodes.push( ( new Node() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Node() {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.sid = \"\";\n\t\tthis.nodes = [];\n\t\tthis.controllers = [];\n\t\tthis.transforms = [];\n\t\tthis.geometries = [];\n\t\tthis.channels = [];\n\t\tthis.matrix = new THREE.Matrix4();\n\n\t}\n\n\tNode.prototype.getChannelForTransform = function( transformSid ) {\n\n\t\tfor ( var i = 0; i < this.channels.length; i ++ ) {\n\n\t\t\tvar channel = this.channels[i];\n\t\t\tvar parts = channel.target.split('/');\n\t\t\tvar id = parts.shift();\n\t\t\tvar sid = parts.shift();\n\t\t\tvar dotSyntax = (sid.indexOf(\".\") >= 0);\n\t\t\tvar arrSyntax = (sid.indexOf(\"(\") >= 0);\n\t\t\tvar arrIndices;\n\t\t\tvar member;\n\n\t\t\tif ( dotSyntax ) {\n\n\t\t\t\tparts = sid.split(\".\");\n\t\t\t\tsid = parts.shift();\n\t\t\t\tmember = parts.shift();\n\n\t\t\t} else if ( arrSyntax ) {\n\n\t\t\t\tarrIndices = sid.split(\"(\");\n\t\t\t\tsid = arrIndices.shift();\n\n\t\t\t\tfor ( var j = 0; j < arrIndices.length; j ++ ) {\n\n\t\t\t\t\tarrIndices[ j ] = parseInt( arrIndices[ j ].replace( /\\)/, '' ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( sid === transformSid ) {\n\n\t\t\t\tchannel.info = { sid: sid, dotSyntax: dotSyntax, arrSyntax: arrSyntax, arrIndices: arrIndices };\n\t\t\t\treturn channel;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tNode.prototype.getChildById = function ( id, recursive ) {\n\n\t\tif ( this.id === id ) {\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tif ( recursive ) {\n\n\t\t\tfor ( var i = 0; i < this.nodes.length; i ++ ) {\n\n\t\t\t\tvar n = this.nodes[ i ].getChildById( id, recursive );\n\n\t\t\t\tif ( n ) {\n\n\t\t\t\t\treturn n;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tNode.prototype.getChildBySid = function ( sid, recursive ) {\n\n\t\tif ( this.sid === sid ) {\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tif ( recursive ) {\n\n\t\t\tfor ( var i = 0; i < this.nodes.length; i ++ ) {\n\n\t\t\t\tvar n = this.nodes[ i ].getChildBySid( sid, recursive );\n\n\t\t\t\tif ( n ) {\n\n\t\t\t\t\treturn n;\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tNode.prototype.getTransformBySid = function ( sid ) {\n\n\t\tfor ( var i = 0; i < this.transforms.length; i ++ ) {\n\n\t\t\tif ( this.transforms[ i ].sid === sid ) return this.transforms[ i ];\n\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tNode.prototype.parse = function( element ) {\n\n\t\tvar url;\n\n\t\tthis.id = element.getAttribute('id');\n\t\tthis.sid = element.getAttribute('sid');\n\t\tthis.name = element.getAttribute('name');\n\t\tthis.type = element.getAttribute('type');\n\t\tthis.layer = element.getAttribute('layer');\n\n\t\tthis.type = this.type === 'JOINT' ? this.type : 'NODE';\n\n\t\tthis.nodes = [];\n\t\tthis.transforms = [];\n\t\tthis.geometries = [];\n\t\tthis.cameras = [];\n\t\tthis.lights = [];\n\t\tthis.controllers = [];\n\t\tthis.matrix = new THREE.Matrix4();\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'node':\n\n\t\t\t\t\tthis.nodes.push( ( new Node() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'instance_camera':\n\n\t\t\t\t\tthis.cameras.push( ( new InstanceCamera() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'instance_controller':\n\n\t\t\t\t\tthis.controllers.push( ( new InstanceController() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'instance_geometry':\n\n\t\t\t\t\tthis.geometries.push( ( new InstanceGeometry() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'instance_light':\n\n\t\t\t\t\tthis.lights.push( ( new InstanceLight() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'instance_node':\n\n\t\t\t\t\turl = child.getAttribute( 'url' ).replace( /^#/, '' );\n\t\t\t\t\tvar iNode = getLibraryNode( url );\n\n\t\t\t\t\tif ( iNode ) {\n\n\t\t\t\t\t\tthis.nodes.push( ( new Node() ).parse( iNode )) ;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\tcase 'translate':\n\t\t\t\tcase 'scale':\n\t\t\t\tcase 'matrix':\n\t\t\t\tcase 'lookat':\n\t\t\t\tcase 'skew':\n\n\t\t\t\t\tthis.transforms.push( ( new Transform() ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'extra':\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.channels = getChannelsForNode( this );\n\t\tbakeAnimations( this );\n\n\t\tthis.updateMatrix();\n\n\t\treturn this;\n\n\t};\n\n\tNode.prototype.updateMatrix = function () {\n\n\t\tthis.matrix.identity();\n\n\t\tfor ( var i = 0; i < this.transforms.length; i ++ ) {\n\n\t\t\tthis.transforms[ i ].apply( this.matrix );\n\n\t\t}\n\n\t};\n\n\tfunction Transform () {\n\n\t\tthis.sid = \"\";\n\t\tthis.type = \"\";\n\t\tthis.data = [];\n\t\tthis.obj = null;\n\n\t}\n\n\tTransform.prototype.parse = function ( element ) {\n\n\t\tthis.sid = element.getAttribute( 'sid' );\n\t\tthis.type = element.nodeName;\n\t\tthis.data = _floats( element.textContent );\n\t\tthis.convert();\n\n\t\treturn this;\n\n\t};\n\n\tTransform.prototype.convert = function () {\n\n\t\tswitch ( this.type ) {\n\n\t\t\tcase 'matrix':\n\n\t\t\t\tthis.obj = getConvertedMat4( this.data );\n\t\t\t\tbreak;\n\n\t\t\tcase 'rotate':\n\n\t\t\t\tthis.angle = THREE.Math.degToRad( this.data[3] );\n\n\t\t\tcase 'translate':\n\n\t\t\t\tfixCoords( this.data, -1 );\n\t\t\t\tthis.obj = new THREE.Vector3( this.data[ 0 ], this.data[ 1 ], this.data[ 2 ] );\n\t\t\t\tbreak;\n\n\t\t\tcase 'scale':\n\n\t\t\t\tfixCoords( this.data, 1 );\n\t\t\t\tthis.obj = new THREE.Vector3( this.data[ 0 ], this.data[ 1 ], this.data[ 2 ] );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.log( 'Can not convert Transform of type ' + this.type );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tTransform.prototype.apply = function () {\n\n\t\tvar m1 = new THREE.Matrix4();\n\n\t\treturn function ( matrix ) {\n\n\t\t\tswitch ( this.type ) {\n\n\t\t\t\tcase 'matrix':\n\n\t\t\t\t\tmatrix.multiply( this.obj );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\n\t\t\t\t\tmatrix.multiply( m1.makeTranslation( this.obj.x, this.obj.y, this.obj.z ) );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\n\t\t\t\t\tmatrix.multiply( m1.makeRotationAxis( this.obj, this.angle ) );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'scale':\n\n\t\t\t\t\tmatrix.scale( this.obj );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t};\n\n\t}();\n\n\tTransform.prototype.update = function ( data, member ) {\n\n\t\tvar members = [ 'X', 'Y', 'Z', 'ANGLE' ];\n\n\t\tswitch ( this.type ) {\n\n\t\t\tcase 'matrix':\n\n\t\t\t\tif ( ! member ) {\n\n\t\t\t\t\tthis.obj.copy( data );\n\n\t\t\t\t} else if ( member.length === 1 ) {\n\n\t\t\t\t\tswitch ( member[ 0 ] ) {\n\n\t\t\t\t\t\tcase 0:\n\n\t\t\t\t\t\t\tthis.obj.n11 = data[ 0 ];\n\t\t\t\t\t\t\tthis.obj.n21 = data[ 1 ];\n\t\t\t\t\t\t\tthis.obj.n31 = data[ 2 ];\n\t\t\t\t\t\t\tthis.obj.n41 = data[ 3 ];\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 1:\n\n\t\t\t\t\t\t\tthis.obj.n12 = data[ 0 ];\n\t\t\t\t\t\t\tthis.obj.n22 = data[ 1 ];\n\t\t\t\t\t\t\tthis.obj.n32 = data[ 2 ];\n\t\t\t\t\t\t\tthis.obj.n42 = data[ 3 ];\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 2:\n\n\t\t\t\t\t\t\tthis.obj.n13 = data[ 0 ];\n\t\t\t\t\t\t\tthis.obj.n23 = data[ 1 ];\n\t\t\t\t\t\t\tthis.obj.n33 = data[ 2 ];\n\t\t\t\t\t\t\tthis.obj.n43 = data[ 3 ];\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 3:\n\n\t\t\t\t\t\t\tthis.obj.n14 = data[ 0 ];\n\t\t\t\t\t\t\tthis.obj.n24 = data[ 1 ];\n\t\t\t\t\t\t\tthis.obj.n34 = data[ 2 ];\n\t\t\t\t\t\t\tthis.obj.n44 = data[ 3 ];\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( member.length === 2 ) {\n\n\t\t\t\t\tvar propName = 'n' + ( member[ 0 ] + 1 ) + ( member[ 1 ] + 1 );\n\t\t\t\t\tthis.obj[ propName ] = data;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.log('Incorrect addressing of matrix in transform.');\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'translate':\n\t\t\tcase 'scale':\n\n\t\t\t\tif ( Object.prototype.toString.call( member ) === '[object Array]' ) {\n\n\t\t\t\t\tmember = members[ member[ 0 ] ];\n\n\t\t\t\t}\n\n\t\t\t\tswitch ( member ) {\n\n\t\t\t\t\tcase 'X':\n\n\t\t\t\t\t\tthis.obj.x = data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Y':\n\n\t\t\t\t\t\tthis.obj.y = data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Z':\n\n\t\t\t\t\t\tthis.obj.z = data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tthis.obj.x = data[ 0 ];\n\t\t\t\t\t\tthis.obj.y = data[ 1 ];\n\t\t\t\t\t\tthis.obj.z = data[ 2 ];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'rotate':\n\n\t\t\t\tif ( Object.prototype.toString.call( member ) === '[object Array]' ) {\n\n\t\t\t\t\tmember = members[ member[ 0 ] ];\n\n\t\t\t\t}\n\n\t\t\t\tswitch ( member ) {\n\n\t\t\t\t\tcase 'X':\n\n\t\t\t\t\t\tthis.obj.x = data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Y':\n\n\t\t\t\t\t\tthis.obj.y = data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Z':\n\n\t\t\t\t\t\tthis.obj.z = data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'ANGLE':\n\n\t\t\t\t\t\tthis.angle = THREE.Math.degToRad( data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tthis.obj.x = data[ 0 ];\n\t\t\t\t\t\tthis.obj.y = data[ 1 ];\n\t\t\t\t\t\tthis.obj.z = data[ 2 ];\n\t\t\t\t\t\tthis.angle = THREE.Math.degToRad( data[ 3 ] );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction InstanceController() {\n\n\t\tthis.url = \"\";\n\t\tthis.skeleton = [];\n\t\tthis.instance_material = [];\n\n\t}\n\n\tInstanceController.prototype.parse = function ( element ) {\n\n\t\tthis.url = element.getAttribute('url').replace(/^#/, '');\n\t\tthis.skeleton = [];\n\t\tthis.instance_material = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'skeleton':\n\n\t\t\t\t\tthis.skeleton.push( child.textContent.replace(/^#/, '') );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bind_material':\n\n\t\t\t\t\tvar instances = child.querySelectorAll('instance_material');\n\n\t\t\t\t\tfor ( var j = 0; j < instances.length; j ++ ) {\n\n\t\t\t\t\t\tvar instance = instances[j];\n\t\t\t\t\t\tthis.instance_material.push( (new InstanceMaterial()).parse(instance) );\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'extra':\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction InstanceMaterial () {\n\n\t\tthis.symbol = \"\";\n\t\tthis.target = \"\";\n\n\t}\n\n\tInstanceMaterial.prototype.parse = function ( element ) {\n\n\t\tthis.symbol = element.getAttribute('symbol');\n\t\tthis.target = element.getAttribute('target').replace(/^#/, '');\n\t\treturn this;\n\n\t};\n\n\tfunction InstanceGeometry() {\n\n\t\tthis.url = \"\";\n\t\tthis.instance_material = [];\n\n\t}\n\n\tInstanceGeometry.prototype.parse = function ( element ) {\n\n\t\tthis.url = element.getAttribute('url').replace(/^#/, '');\n\t\tthis.instance_material = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tif ( child.nodeName === 'bind_material' ) {\n\n\t\t\t\tvar instances = child.querySelectorAll('instance_material');\n\n\t\t\t\tfor ( var j = 0; j < instances.length; j ++ ) {\n\n\t\t\t\t\tvar instance = instances[j];\n\t\t\t\t\tthis.instance_material.push( (new InstanceMaterial()).parse(instance) );\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Geometry() {\n\n\t\tthis.id = \"\";\n\t\tthis.mesh = null;\n\n\t}\n\n\tGeometry.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute('id');\n\n\t\textractDoubleSided( this, element );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'mesh':\n\n\t\t\t\t\tthis.mesh = (new Mesh(this)).parse(child);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'extra':\n\n\t\t\t\t\t// console.log( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Mesh( geometry ) {\n\n\t\tthis.geometry = geometry.id;\n\t\tthis.primitives = [];\n\t\tthis.vertices = null;\n\t\tthis.geometry3js = null;\n\n\t}\n\n\tMesh.prototype.parse = function ( element ) {\n\n\t\tthis.primitives = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'source':\n\n\t\t\t\t\t_source( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'vertices':\n\n\t\t\t\t\tthis.vertices = ( new Vertices() ).parse( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'linestrips':\n\n\t\t\t\t\tthis.primitives.push( ( new LineStrips().parse( child ) ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'triangles':\n\n\t\t\t\t\tthis.primitives.push( ( new Triangles().parse( child ) ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'polygons':\n\n\t\t\t\t\tthis.primitives.push( ( new Polygons().parse( child ) ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'polylist':\n\n\t\t\t\t\tthis.primitives.push( ( new Polylist().parse( child ) ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.geometry3js = new THREE.Geometry();\n\n\t\tif ( this.vertices === null ) {\n\n\t\t\t// TODO (mrdoob): Study case when this is null (carrier.dae)\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tvar vertexData = sources[ this.vertices.input['POSITION'].source ].data;\n\n\t\tfor ( var i = 0; i < vertexData.length; i += 3 ) {\n\n\t\t\tthis.geometry3js.vertices.push( getConvertedVec3( vertexData, i ).clone() );\n\n\t\t}\n\n\t\tfor ( var i = 0; i < this.primitives.length; i ++ ) {\n\n\t\t\tvar primitive = this.primitives[ i ];\n\t\t\tprimitive.setVertices( this.vertices );\n\t\t\tthis.handlePrimitive( primitive, this.geometry3js );\n\n\t\t}\n\n\t\tif ( this.geometry3js.calcNormals ) {\n\n\t\t\tthis.geometry3js.computeVertexNormals();\n\t\t\tdelete this.geometry3js.calcNormals;\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tMesh.prototype.handlePrimitive = function ( primitive, geom ) {\n\n\t\tif ( primitive instanceof LineStrips ) {\n\n\t\t\t// TODO: Handle indices. Maybe easier with BufferGeometry?\n\n\t\t\tgeom.isLineStrip = true;\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar j, k, pList = primitive.p, inputs = primitive.inputs;\n\t\tvar input, index, idx32;\n\t\tvar source, numParams;\n\t\tvar vcIndex = 0, vcount = 3, maxOffset = 0;\n\t\tvar texture_sets = [];\n\n\t\tfor ( j = 0; j < inputs.length; j ++ ) {\n\n\t\t\tinput = inputs[ j ];\n\n\t\t\tvar offset = input.offset + 1;\n\t\t\tmaxOffset = (maxOffset < offset) ? offset : maxOffset;\n\n\t\t\tswitch ( input.semantic ) {\n\n\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\ttexture_sets.push( input.set );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var pCount = 0; pCount < pList.length; ++ pCount ) {\n\n\t\t\tvar p = pList[ pCount ], i = 0;\n\n\t\t\twhile ( i < p.length ) {\n\n\t\t\t\tvar vs = [];\n\t\t\t\tvar ns = [];\n\t\t\t\tvar ts = null;\n\t\t\t\tvar cs = [];\n\n\t\t\t\tif ( primitive.vcount ) {\n\n\t\t\t\t\tvcount = primitive.vcount.length ? primitive.vcount[ vcIndex ++ ] : primitive.vcount;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvcount = p.length / maxOffset;\n\n\t\t\t\t}\n\n\n\t\t\t\tfor ( j = 0; j < vcount; j ++ ) {\n\n\t\t\t\t\tfor ( k = 0; k < inputs.length; k ++ ) {\n\n\t\t\t\t\t\tinput = inputs[ k ];\n\t\t\t\t\t\tsource = sources[ input.source ];\n\n\t\t\t\t\t\tindex = p[ i + ( j * maxOffset ) + input.offset ];\n\t\t\t\t\t\tnumParams = source.accessor.params.length;\n\t\t\t\t\t\tidx32 = index * numParams;\n\n\t\t\t\t\t\tswitch ( input.semantic ) {\n\n\t\t\t\t\t\t\tcase 'VERTEX':\n\n\t\t\t\t\t\t\t\tvs.push( index );\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'NORMAL':\n\n\t\t\t\t\t\t\t\tns.push( getConvertedVec3( source.data, idx32 ) );\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'TEXCOORD':\n\n\t\t\t\t\t\t\t\tts = ts || { };\n\t\t\t\t\t\t\t\tif ( ts[ input.set ] === undefined ) ts[ input.set ] = [];\n\t\t\t\t\t\t\t\t// invert the V\n\t\t\t\t\t\t\t\tts[ input.set ].push( new THREE.Vector2( source.data[ idx32 ], source.data[ idx32 + 1 ] ) );\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'COLOR':\n\n\t\t\t\t\t\t\t\tcs.push( new THREE.Color().setRGB( source.data[ idx32 ], source.data[ idx32 + 1 ], source.data[ idx32 + 2 ] ) );\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( ns.length === 0 ) {\n\n\t\t\t\t\t// check the vertices inputs\n\t\t\t\t\tinput = this.vertices.input.NORMAL;\n\n\t\t\t\t\tif ( input ) {\n\n\t\t\t\t\t\tsource = sources[ input.source ];\n\t\t\t\t\t\tnumParams = source.accessor.params.length;\n\n\t\t\t\t\t\tfor ( var ndx = 0, len = vs.length; ndx < len; ndx ++ ) {\n\n\t\t\t\t\t\t\tns.push( getConvertedVec3( source.data, vs[ ndx ] * numParams ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tgeom.calcNormals = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( !ts ) {\n\n\t\t\t\t\tts = { };\n\t\t\t\t\t// check the vertices inputs\n\t\t\t\t\tinput = this.vertices.input.TEXCOORD;\n\n\t\t\t\t\tif ( input ) {\n\n\t\t\t\t\t\ttexture_sets.push( input.set );\n\t\t\t\t\t\tsource = sources[ input.source ];\n\t\t\t\t\t\tnumParams = source.accessor.params.length;\n\n\t\t\t\t\t\tfor ( var ndx = 0, len = vs.length; ndx < len; ndx ++ ) {\n\n\t\t\t\t\t\t\tidx32 = vs[ ndx ] * numParams;\n\t\t\t\t\t\t\tif ( ts[ input.set ] === undefined ) ts[ input.set ] = [ ];\n\t\t\t\t\t\t\t// invert the V\n\t\t\t\t\t\t\tts[ input.set ].push( new THREE.Vector2( source.data[ idx32 ], 1.0 - source.data[ idx32 + 1 ] ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( cs.length === 0 ) {\n\n\t\t\t\t\t// check the vertices inputs\n\t\t\t\t\tinput = this.vertices.input.COLOR;\n\n\t\t\t\t\tif ( input ) {\n\n\t\t\t\t\t\tsource = sources[ input.source ];\n\t\t\t\t\t\tnumParams = source.accessor.params.length;\n\n\t\t\t\t\t\tfor ( var ndx = 0, len = vs.length; ndx < len; ndx ++ ) {\n\n\t\t\t\t\t\t\tidx32 = vs[ ndx ] * numParams;\n\t\t\t\t\t\t\tcs.push( new THREE.Color().setRGB( source.data[ idx32 ], source.data[ idx32 + 1 ], source.data[ idx32 + 2 ] ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar face = null, faces = [], uv, uvArr;\n\n\t\t\t\tif ( vcount === 3 ) {\n\n\t\t\t\t\tfaces.push( new THREE.Face3( vs[0], vs[1], vs[2], ns, cs.length ? cs : new THREE.Color() ) );\n\n\t\t\t\t} else if ( vcount === 4 ) {\n\n\t\t\t\t\tfaces.push( new THREE.Face3( vs[0], vs[1], vs[3], ns.length ? [ ns[0].clone(), ns[1].clone(), ns[3].clone() ] : [], cs.length ? [ cs[0], cs[1], cs[3] ] : new THREE.Color() ) );\n\n\t\t\t\t\tfaces.push( new THREE.Face3( vs[1], vs[2], vs[3], ns.length ? [ ns[1].clone(), ns[2].clone(), ns[3].clone() ] : [], cs.length ? [ cs[1], cs[2], cs[3] ] : new THREE.Color() ) );\n\n\t\t\t\t} else if ( vcount > 4 && options.subdivideFaces ) {\n\n\t\t\t\t\tvar clr = cs.length ? cs : new THREE.Color(),\n\t\t\t\t\t\tvec1, vec2, vec3, v1, v2, norm;\n\n\t\t\t\t\t// subdivide into multiple Face3s\n\n\t\t\t\t\tfor ( k = 1; k < vcount - 1; ) {\n\n\t\t\t\t\t\tfaces.push( new THREE.Face3( vs[0], vs[k], vs[k + 1], ns.length ? [ ns[0].clone(), ns[k ++].clone(), ns[k].clone() ] : [], clr ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( faces.length ) {\n\n\t\t\t\t\tfor ( var ndx = 0, len = faces.length; ndx < len; ndx ++ ) {\n\n\t\t\t\t\t\tface = faces[ndx];\n\t\t\t\t\t\tface.daeMaterial = primitive.material;\n\t\t\t\t\t\tgeom.faces.push( face );\n\n\t\t\t\t\t\tfor ( k = 0; k < texture_sets.length; k ++ ) {\n\n\t\t\t\t\t\t\tuv = ts[ texture_sets[k] ];\n\n\t\t\t\t\t\t\tif ( vcount > 4 ) {\n\n\t\t\t\t\t\t\t\t// Grab the right UVs for the vertices in this face\n\t\t\t\t\t\t\t\tuvArr = [ uv[0], uv[ndx + 1], uv[ndx + 2] ];\n\n\t\t\t\t\t\t\t} else if ( vcount === 4 ) {\n\n\t\t\t\t\t\t\t\tif ( ndx === 0 ) {\n\n\t\t\t\t\t\t\t\t\tuvArr = [ uv[0], uv[1], uv[3] ];\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\tuvArr = [ uv[1].clone(), uv[2], uv[3].clone() ];\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tuvArr = [ uv[0], uv[1], uv[2] ];\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( geom.faceVertexUvs[k] === undefined ) {\n\n\t\t\t\t\t\t\t\tgeom.faceVertexUvs[k] = [];\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tgeom.faceVertexUvs[k].push( uvArr );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.log( 'dropped face with vcount ' + vcount + ' for geometry with id: ' + geom.id );\n\n\t\t\t\t}\n\n\t\t\t\ti += maxOffset * vcount;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tfunction Polygons () {\n\n\t\tthis.material = \"\";\n\t\tthis.count = 0;\n\t\tthis.inputs = [];\n\t\tthis.vcount = null;\n\t\tthis.p = [];\n\t\tthis.geometry = new THREE.Geometry();\n\n\t}\n\n\tPolygons.prototype.setVertices = function ( vertices ) {\n\n\t\tfor ( var i = 0; i < this.inputs.length; i ++ ) {\n\n\t\t\tif ( this.inputs[ i ].source === vertices.id ) {\n\n\t\t\t\tthis.inputs[ i ].source = vertices.input[ 'POSITION' ].source;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tPolygons.prototype.parse = function ( element ) {\n\n\t\tthis.material = element.getAttribute( 'material' );\n\t\tthis.count = _attr_as_int( element, 'count', 0 );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'input':\n\n\t\t\t\t\tthis.inputs.push( ( new Input() ).parse( element.childNodes[ i ] ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'vcount':\n\n\t\t\t\t\tthis.vcount = _ints( child.textContent );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'p':\n\n\t\t\t\t\tthis.p.push( _ints( child.textContent ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ph':\n\n\t\t\t\t\tconsole.warn( 'polygon holes not yet supported!' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Polylist () {\n\n\t\tPolygons.call( this );\n\n\t\tthis.vcount = [];\n\n\t}\n\n\tPolylist.prototype = Object.create( Polygons.prototype );\n\tPolylist.prototype.constructor = Polylist;\n\n\tfunction LineStrips() {\n\n\t\tPolygons.call( this );\n\n\t\tthis.vcount = 1;\n\n\t}\n\n\tLineStrips.prototype = Object.create( Polygons.prototype );\n\tLineStrips.prototype.constructor = LineStrips;\n\n\tfunction Triangles () {\n\n\t\tPolygons.call( this );\n\n\t\tthis.vcount = 3;\n\n\t}\n\n\tTriangles.prototype = Object.create( Polygons.prototype );\n\tTriangles.prototype.constructor = Triangles;\n\n\tfunction Accessor() {\n\n\t\tthis.source = \"\";\n\t\tthis.count = 0;\n\t\tthis.stride = 0;\n\t\tthis.params = [];\n\n\t}\n\n\tAccessor.prototype.parse = function ( element ) {\n\n\t\tthis.params = [];\n\t\tthis.source = element.getAttribute( 'source' );\n\t\tthis.count = _attr_as_int( element, 'count', 0 );\n\t\tthis.stride = _attr_as_int( element, 'stride', 0 );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tif ( child.nodeName === 'param' ) {\n\n\t\t\t\tvar param = {};\n\t\t\t\tparam[ 'name' ] = child.getAttribute( 'name' );\n\t\t\t\tparam[ 'type' ] = child.getAttribute( 'type' );\n\t\t\t\tthis.params.push( param );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Vertices() {\n\n\t\tthis.input = {};\n\n\t}\n\n\tVertices.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute('id');\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tif ( element.childNodes[i].nodeName === 'input' ) {\n\n\t\t\t\tvar input = ( new Input() ).parse( element.childNodes[ i ] );\n\t\t\t\tthis.input[ input.semantic ] = input;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Input () {\n\n\t\tthis.semantic = \"\";\n\t\tthis.offset = 0;\n\t\tthis.source = \"\";\n\t\tthis.set = 0;\n\n\t}\n\n\tInput.prototype.parse = function ( element ) {\n\n\t\tthis.semantic = element.getAttribute('semantic');\n\t\tthis.source = element.getAttribute('source').replace(/^#/, '');\n\t\tthis.set = _attr_as_int(element, 'set', -1);\n\t\tthis.offset = _attr_as_int(element, 'offset', 0);\n\n\t\tif ( this.semantic === 'TEXCOORD' && this.set < 0 ) {\n\n\t\t\tthis.set = 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Source ( id ) {\n\n\t\tthis.id = id;\n\t\tthis.type = null;\n\n\t}\n\n\tSource.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'bool_array':\n\n\t\t\t\t\tthis.data = _bools( child.textContent );\n\t\t\t\t\tthis.type = child.nodeName;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'float_array':\n\n\t\t\t\t\tthis.data = _floats( child.textContent );\n\t\t\t\t\tthis.type = child.nodeName;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'int_array':\n\n\t\t\t\t\tthis.data = _ints( child.textContent );\n\t\t\t\t\tthis.type = child.nodeName;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'IDREF_array':\n\t\t\t\tcase 'Name_array':\n\n\t\t\t\t\tthis.data = _strings( child.textContent );\n\t\t\t\t\tthis.type = child.nodeName;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'technique_common':\n\n\t\t\t\t\tfor ( var j = 0; j < child.childNodes.length; j ++ ) {\n\n\t\t\t\t\t\tif ( child.childNodes[ j ].nodeName === 'accessor' ) {\n\n\t\t\t\t\t\t\tthis.accessor = ( new Accessor() ).parse( child.childNodes[ j ] );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// console.log(child.nodeName);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tSource.prototype.read = function () {\n\n\t\tvar result = [];\n\n\t\t//for (var i = 0; i < this.accessor.params.length; i++) {\n\n\t\tvar param = this.accessor.params[ 0 ];\n\n\t\t\t//console.log(param.name + \" \" + param.type);\n\n\t\tswitch ( param.type ) {\n\n\t\t\tcase 'IDREF':\n\t\t\tcase 'Name': case 'name':\n\t\t\tcase 'float':\n\n\t\t\t\treturn this.data;\n\n\t\t\tcase 'float4x4':\n\n\t\t\t\tfor ( var j = 0; j < this.data.length; j += 16 ) {\n\n\t\t\t\t\tvar s = this.data.slice( j, j + 16 );\n\t\t\t\t\tvar m = getConvertedMat4( s );\n\t\t\t\t\tresult.push( m );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tconsole.log( 'ColladaLoader: Source: Read dont know how to read ' + param.type + '.' );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t//}\n\n\t\treturn result;\n\n\t};\n\n\tfunction Material () {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.instance_effect = null;\n\n\t}\n\n\tMaterial.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.name = element.getAttribute( 'name' );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tif ( element.childNodes[ i ].nodeName === 'instance_effect' ) {\n\n\t\t\t\tthis.instance_effect = ( new InstanceEffect() ).parse( element.childNodes[ i ] );\n\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction ColorOrTexture () {\n\n\t\tthis.color = new THREE.Color();\n\t\tthis.color.setRGB( Math.random(), Math.random(), Math.random() );\n\t\tthis.color.a = 1.0;\n\n\t\tthis.texture = null;\n\t\tthis.texcoord = null;\n\t\tthis.texOpts = null;\n\n\t}\n\n\tColorOrTexture.prototype.isColor = function () {\n\n\t\treturn ( this.texture === null );\n\n\t};\n\n\tColorOrTexture.prototype.isTexture = function () {\n\n\t\treturn ( this.texture != null );\n\n\t};\n\n\tColorOrTexture.prototype.parse = function ( element ) {\n\n\t\tif (element.nodeName === 'transparent') {\n\n\t\t\tthis.opaque = element.getAttribute('opaque');\n\n\t\t}\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'color':\n\n\t\t\t\t\tvar rgba = _floats( child.textContent );\n\t\t\t\t\tthis.color = new THREE.Color();\n\t\t\t\t\tthis.color.setRGB( rgba[0], rgba[1], rgba[2] );\n\t\t\t\t\tthis.color.a = rgba[3];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\n\t\t\t\t\tthis.texture = child.getAttribute('texture');\n\t\t\t\t\tthis.texcoord = child.getAttribute('texcoord');\n\t\t\t\t\t// Defaults from:\n\t\t\t\t\t// https://collada.org/mediawiki/index.php/Maya_texture_placement_MAYA_extension\n\t\t\t\t\tthis.texOpts = {\n\t\t\t\t\t\toffsetU: 0,\n\t\t\t\t\t\toffsetV: 0,\n\t\t\t\t\t\trepeatU: 1,\n\t\t\t\t\t\trepeatV: 1,\n\t\t\t\t\t\twrapU: 1,\n\t\t\t\t\t\twrapV: 1\n\t\t\t\t\t};\n\t\t\t\t\tthis.parseTexture( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tColorOrTexture.prototype.parseTexture = function ( element ) {\n\n\t\tif ( ! element.childNodes ) return this;\n\n\t\t// This should be supported by Maya, 3dsMax, and MotionBuilder\n\n\t\tif ( element.childNodes[1] && element.childNodes[1].nodeName === 'extra' ) {\n\n\t\t\telement = element.childNodes[1];\n\n\t\t\tif ( element.childNodes[1] && element.childNodes[1].nodeName === 'technique' ) {\n\n\t\t\t\telement = element.childNodes[1];\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'offsetU':\n\t\t\t\tcase 'offsetV':\n\t\t\t\tcase 'repeatU':\n\t\t\t\tcase 'repeatV':\n\n\t\t\t\t\tthis.texOpts[ child.nodeName ] = parseFloat( child.textContent );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'wrapU':\n\t\t\t\tcase 'wrapV':\n\n\t\t\t\t\t// some dae have a value of true which becomes NaN via parseInt\n\n\t\t\t\t\tif ( child.textContent.toUpperCase() === 'TRUE' ) {\n\n\t\t\t\t\t\tthis.texOpts[ child.nodeName ] = 1;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tthis.texOpts[ child.nodeName ] = parseInt( child.textContent );\n\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tthis.texOpts[ child.nodeName ] = child.textContent;\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Shader ( type, effect ) {\n\n\t\tthis.type = type;\n\t\tthis.effect = effect;\n\t\tthis.material = null;\n\n\t}\n\n\tShader.prototype.parse = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'emission':\n\t\t\t\tcase 'diffuse':\n\t\t\t\tcase 'specular':\n\t\t\t\tcase 'transparent':\n\n\t\t\t\t\tthis[ child.nodeName ] = ( new ColorOrTexture() ).parse( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bump':\n\n\t\t\t\t\t// If 'bumptype' is 'heightfield', create a 'bump' property\n\t\t\t\t\t// Else if 'bumptype' is 'normalmap', create a 'normal' property\n\t\t\t\t\t// (Default to 'bump')\n\t\t\t\t\tvar bumpType = child.getAttribute( 'bumptype' );\n\t\t\t\t\tif ( bumpType ) {\n\t\t\t\t\t\tif ( bumpType.toLowerCase() === \"heightfield\" ) {\n\t\t\t\t\t\t\tthis[ 'bump' ] = ( new ColorOrTexture() ).parse( child );\n\t\t\t\t\t\t} else if ( bumpType.toLowerCase() === \"normalmap\" ) {\n\t\t\t\t\t\t\tthis[ 'normal' ] = ( new ColorOrTexture() ).parse( child );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error( \"Shader.prototype.parse: Invalid value for attribute 'bumptype' (\" + bumpType + \") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'\" );\n\t\t\t\t\t\t\tthis[ 'bump' ] = ( new ColorOrTexture() ).parse( child );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn( \"Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'\" );\n\t\t\t\t\t\tthis[ 'bump' ] = ( new ColorOrTexture() ).parse( child );\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'shininess':\n\t\t\t\tcase 'reflectivity':\n\t\t\t\tcase 'index_of_refraction':\n\t\t\t\tcase 'transparency':\n\n\t\t\t\t\tvar f = child.querySelectorAll('float');\n\n\t\t\t\t\tif ( f.length > 0 )\n\t\t\t\t\t\tthis[ child.nodeName ] = parseFloat( f[ 0 ].textContent );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.create();\n\t\treturn this;\n\n\t};\n\n\tShader.prototype.create = function() {\n\n\t\tvar props = {};\n\n\t\tvar transparent = false;\n\n\t\tif (this['transparency'] !== undefined && this['transparent'] !== undefined) {\n\t\t\t// convert transparent color RBG to average value\n\t\t\tvar transparentColor = this['transparent'];\n\t\t\tvar transparencyLevel = (this.transparent.color.r + this.transparent.color.g + this.transparent.color.b) / 3 * this.transparency;\n\n\t\t\tif (transparencyLevel > 0) {\n\t\t\t\ttransparent = true;\n\t\t\t\tprops[ 'transparent' ] = true;\n\t\t\t\tprops[ 'opacity' ] = 1 - transparencyLevel;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar keys = {\n\t\t\t'diffuse':'map',\n\t\t\t'ambient':'lightMap',\n\t\t\t'specular':'specularMap',\n\t\t\t'emission':'emissionMap',\n\t\t\t'bump':'bumpMap',\n\t\t\t'normal':'normalMap'\n\t\t\t};\n\n\t\tfor ( var prop in this ) {\n\n\t\t\tswitch ( prop ) {\n\n\t\t\t\tcase 'ambient':\n\t\t\t\tcase 'emission':\n\t\t\t\tcase 'diffuse':\n\t\t\t\tcase 'specular':\n\t\t\t\tcase 'bump':\n\t\t\t\tcase 'normal':\n\n\t\t\t\t\tvar cot = this[ prop ];\n\n\t\t\t\t\tif ( cot instanceof ColorOrTexture ) {\n\n\t\t\t\t\t\tif ( cot.isTexture() ) {\n\n\t\t\t\t\t\t\tvar samplerId = cot.texture;\n\t\t\t\t\t\t\tvar surfaceId = this.effect.sampler[samplerId];\n\n\t\t\t\t\t\t\tif ( surfaceId !== undefined && surfaceId.source !== undefined ) {\n\n\t\t\t\t\t\t\t\tvar surface = this.effect.surface[surfaceId.source];\n\n\t\t\t\t\t\t\t\tif ( surface !== undefined ) {\n\n\t\t\t\t\t\t\t\t\tvar image = images[ surface.init_from ];\n\n\t\t\t\t\t\t\t\t\tif ( image ) {\n\n\t\t\t\t\t\t\t\t\t\tvar url = baseUrl + image.init_from;\n\n\t\t\t\t\t\t\t\t\t\tvar texture;\n\t\t\t\t\t\t\t\t\t\tvar loader = THREE.Loader.Handlers.get( url );\n\n\t\t\t\t\t\t\t\t\t\tif ( loader !== null ) {\n\n\t\t\t\t\t\t\t\t\t\t\ttexture = loader.load( url );\n\n\t\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\t\ttexture = new THREE.Texture();\n\n\t\t\t\t\t\t\t\t\t\t\tloadTextureImage( texture, url );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\ttexture.wrapS = cot.texOpts.wrapU ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\t\t\t\t\t\t\t\t\t\ttexture.wrapT = cot.texOpts.wrapV ? THREE.RepeatWrapping : THREE.ClampToEdgeWrapping;\n\t\t\t\t\t\t\t\t\t\ttexture.offset.x = cot.texOpts.offsetU;\n\t\t\t\t\t\t\t\t\t\ttexture.offset.y = cot.texOpts.offsetV;\n\t\t\t\t\t\t\t\t\t\ttexture.repeat.x = cot.texOpts.repeatU;\n\t\t\t\t\t\t\t\t\t\ttexture.repeat.y = cot.texOpts.repeatV;\n\t\t\t\t\t\t\t\t\t\tprops[keys[prop]] = texture;\n\n\t\t\t\t\t\t\t\t\t\t// Texture with baked lighting?\n\t\t\t\t\t\t\t\t\t\tif (prop === 'emission') props['emissive'] = 0xffffff;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else if ( prop === 'diffuse' || !transparent ) {\n\n\t\t\t\t\t\t\tif ( prop === 'emission' ) {\n\n\t\t\t\t\t\t\t\tprops[ 'emissive' ] = cot.color.getHex();\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tprops[ prop ] = cot.color.getHex();\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'shininess':\n\n\t\t\t\t\tprops[ prop ] = this[ prop ];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'reflectivity':\n\n\t\t\t\t\tprops[ prop ] = this[ prop ];\n\t\t\t\t\tif ( props[ prop ] > 0.0 ) props['envMap'] = options.defaultEnvMap;\n\t\t\t\t\tprops['combine'] = THREE.MixOperation;\t//mix regular shading with reflective component\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'index_of_refraction':\n\n\t\t\t\t\tprops[ 'refractionRatio' ] = this[ prop ]; //TODO: \"index_of_refraction\" becomes \"refractionRatio\" in shader, but I'm not sure if the two are actually comparable\n\t\t\t\t\tif ( this[ prop ] !== 1.0 ) props['envMap'] = options.defaultEnvMap;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'transparency':\n\t\t\t\t\t// gets figured out up top\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tprops[ 'shading' ] = preferredShading;\n\t\tprops[ 'side' ] = this.effect.doubleSided ? THREE.DoubleSide : THREE.FrontSide;\n\n\t\tif ( props.diffuse !== undefined ) {\n\n\t\t\tprops.color = props.diffuse;\n\t\t\tdelete props.diffuse;\n\n\t\t}\n\n\t\tswitch ( this.type ) {\n\n\t\t\tcase 'constant':\n\n\t\t\t\tif (props.emissive != undefined) props.color = props.emissive;\n\t\t\t\tthis.material = new THREE.MeshBasicMaterial( props );\n\t\t\t\tbreak;\n\n\t\t\tcase 'phong':\n\t\t\tcase 'blinn':\n\n\t\t\t\tthis.material = new THREE.MeshPhongMaterial( props );\n\t\t\t\tbreak;\n\n\t\t\tcase 'lambert':\n\t\t\tdefault:\n\n\t\t\t\tthis.material = new THREE.MeshLambertMaterial( props );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn this.material;\n\n\t};\n\n\tfunction Surface ( effect ) {\n\n\t\tthis.effect = effect;\n\t\tthis.init_from = null;\n\t\tthis.format = null;\n\n\t}\n\n\tSurface.prototype.parse = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'init_from':\n\n\t\t\t\t\tthis.init_from = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'format':\n\n\t\t\t\t\tthis.format = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( \"unhandled Surface prop: \" + child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Sampler2D ( effect ) {\n\n\t\tthis.effect = effect;\n\t\tthis.source = null;\n\t\tthis.wrap_s = null;\n\t\tthis.wrap_t = null;\n\t\tthis.minfilter = null;\n\t\tthis.magfilter = null;\n\t\tthis.mipfilter = null;\n\n\t}\n\n\tSampler2D.prototype.parse = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'source':\n\n\t\t\t\t\tthis.source = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'minfilter':\n\n\t\t\t\t\tthis.minfilter = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'magfilter':\n\n\t\t\t\t\tthis.magfilter = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mipfilter':\n\n\t\t\t\t\tthis.mipfilter = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'wrap_s':\n\n\t\t\t\t\tthis.wrap_s = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'wrap_t':\n\n\t\t\t\t\tthis.wrap_t = child.textContent;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( \"unhandled Sampler2D prop: \" + child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Effect () {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.shader = null;\n\t\tthis.surface = {};\n\t\tthis.sampler = {};\n\n\t}\n\n\tEffect.prototype.create = function () {\n\n\t\tif ( this.shader === null ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t};\n\n\tEffect.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.name = element.getAttribute( 'name' );\n\n\t\textractDoubleSided( this, element );\n\n\t\tthis.shader = null;\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'profile_COMMON':\n\n\t\t\t\t\tthis.parseTechnique( this.parseProfileCOMMON( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tEffect.prototype.parseNewparam = function ( element ) {\n\n\t\tvar sid = element.getAttribute( 'sid' );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'surface':\n\n\t\t\t\t\tthis.surface[sid] = ( new Surface( this ) ).parse( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'sampler2D':\n\n\t\t\t\t\tthis.sampler[sid] = ( new Sampler2D( this ) ).parse( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'extra':\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tEffect.prototype.parseProfileCOMMON = function ( element ) {\n\n\t\tvar technique;\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'profile_COMMON':\n\n\t\t\t\t\tthis.parseProfileCOMMON( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'technique':\n\n\t\t\t\t\ttechnique = child;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'newparam':\n\n\t\t\t\t\tthis.parseNewparam( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'image':\n\n\t\t\t\t\tvar _image = ( new _Image() ).parse( child );\n\t\t\t\t\timages[ _image.id ] = _image;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'extra':\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log( child.nodeName );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn technique;\n\n\t};\n\n\tEffect.prototype.parseTechnique = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'constant':\n\t\t\t\tcase 'lambert':\n\t\t\t\tcase 'blinn':\n\t\t\t\tcase 'phong':\n\n\t\t\t\t\tthis.shader = ( new Shader( child.nodeName, this ) ).parse( child );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'extra':\n\t\t\t\t\tthis.parseExtra(child);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tEffect.prototype.parseExtra = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'technique':\n\t\t\t\t\tthis.parseExtraTechnique( child );\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tEffect.prototype.parseExtraTechnique = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[i];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'bump':\n\t\t\t\t\tthis.shader.parse( element );\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tfunction InstanceEffect () {\n\n\t\tthis.url = \"\";\n\n\t}\n\n\tInstanceEffect.prototype.parse = function ( element ) {\n\n\t\tthis.url = element.getAttribute( 'url' ).replace( /^#/, '' );\n\t\treturn this;\n\n\t};\n\n\tfunction Animation() {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.source = {};\n\t\tthis.sampler = [];\n\t\tthis.channel = [];\n\n\t}\n\n\tAnimation.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.name = element.getAttribute( 'name' );\n\t\tthis.source = {};\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'animation':\n\n\t\t\t\t\tvar anim = ( new Animation() ).parse( child );\n\n\t\t\t\t\tfor ( var src in anim.source ) {\n\n\t\t\t\t\t\tthis.source[ src ] = anim.source[ src ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var j = 0; j < anim.channel.length; j ++ ) {\n\n\t\t\t\t\t\tthis.channel.push( anim.channel[ j ] );\n\t\t\t\t\t\tthis.sampler.push( anim.sampler[ j ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'source':\n\n\t\t\t\t\tvar src = ( new Source() ).parse( child );\n\t\t\t\t\tthis.source[ src.id ] = src;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'sampler':\n\n\t\t\t\t\tthis.sampler.push( ( new Sampler( this ) ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'channel':\n\n\t\t\t\t\tthis.channel.push( ( new Channel( this ) ).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Channel( animation ) {\n\n\t\tthis.animation = animation;\n\t\tthis.source = \"\";\n\t\tthis.target = \"\";\n\t\tthis.fullSid = null;\n\t\tthis.sid = null;\n\t\tthis.dotSyntax = null;\n\t\tthis.arrSyntax = null;\n\t\tthis.arrIndices = null;\n\t\tthis.member = null;\n\n\t}\n\n\tChannel.prototype.parse = function ( element ) {\n\n\t\tthis.source = element.getAttribute( 'source' ).replace( /^#/, '' );\n\t\tthis.target = element.getAttribute( 'target' );\n\n\t\tvar parts = this.target.split( '/' );\n\n\t\tvar id = parts.shift();\n\t\tvar sid = parts.shift();\n\n\t\tvar dotSyntax = ( sid.indexOf(\".\") >= 0 );\n\t\tvar arrSyntax = ( sid.indexOf(\"(\") >= 0 );\n\n\t\tif ( dotSyntax ) {\n\n\t\t\tparts = sid.split(\".\");\n\t\t\tthis.sid = parts.shift();\n\t\t\tthis.member = parts.shift();\n\n\t\t} else if ( arrSyntax ) {\n\n\t\t\tvar arrIndices = sid.split(\"(\");\n\t\t\tthis.sid = arrIndices.shift();\n\n\t\t\tfor (var j = 0; j < arrIndices.length; j ++ ) {\n\n\t\t\t\tarrIndices[j] = parseInt( arrIndices[j].replace(/\\)/, '') );\n\n\t\t\t}\n\n\t\t\tthis.arrIndices = arrIndices;\n\n\t\t} else {\n\n\t\t\tthis.sid = sid;\n\n\t\t}\n\n\t\tthis.fullSid = sid;\n\t\tthis.dotSyntax = dotSyntax;\n\t\tthis.arrSyntax = arrSyntax;\n\n\t\treturn this;\n\n\t};\n\n\tfunction Sampler ( animation ) {\n\n\t\tthis.id = \"\";\n\t\tthis.animation = animation;\n\t\tthis.inputs = [];\n\t\tthis.input = null;\n\t\tthis.output = null;\n\t\tthis.strideOut = null;\n\t\tthis.interpolation = null;\n\t\tthis.startTime = null;\n\t\tthis.endTime = null;\n\t\tthis.duration = 0;\n\n\t}\n\n\tSampler.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.inputs = [];\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'input':\n\n\t\t\t\t\tthis.inputs.push( (new Input()).parse( child ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tSampler.prototype.create = function () {\n\n\t\tfor ( var i = 0; i < this.inputs.length; i ++ ) {\n\n\t\t\tvar input = this.inputs[ i ];\n\t\t\tvar source = this.animation.source[ input.source ];\n\n\t\t\tswitch ( input.semantic ) {\n\n\t\t\t\tcase 'INPUT':\n\n\t\t\t\t\tthis.input = source.read();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'OUTPUT':\n\n\t\t\t\t\tthis.output = source.read();\n\t\t\t\t\tthis.strideOut = source.accessor.stride;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'INTERPOLATION':\n\n\t\t\t\t\tthis.interpolation = source.read();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'IN_TANGENT':\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'OUT_TANGENT':\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tconsole.log(input.semantic);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.startTime = 0;\n\t\tthis.endTime = 0;\n\t\tthis.duration = 0;\n\n\t\tif ( this.input.length ) {\n\n\t\t\tthis.startTime = 100000000;\n\t\t\tthis.endTime = -100000000;\n\n\t\t\tfor ( var i = 0; i < this.input.length; i ++ ) {\n\n\t\t\t\tthis.startTime = Math.min( this.startTime, this.input[ i ] );\n\t\t\t\tthis.endTime = Math.max( this.endTime, this.input[ i ] );\n\n\t\t\t}\n\n\t\t\tthis.duration = this.endTime - this.startTime;\n\n\t\t}\n\n\t};\n\n\tSampler.prototype.getData = function ( type, ndx, member ) {\n\n\t\tvar data;\n\n\t\tif ( type === 'matrix' && this.strideOut === 16 ) {\n\n\t\t\tdata = this.output[ ndx ];\n\n\t\t} else if ( this.strideOut > 1 ) {\n\n\t\t\tdata = [];\n\t\t\tndx *= this.strideOut;\n\n\t\t\tfor ( var i = 0; i < this.strideOut; ++ i ) {\n\n\t\t\t\tdata[ i ] = this.output[ ndx + i ];\n\n\t\t\t}\n\n\t\t\tif ( this.strideOut === 3 ) {\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\tcase 'translate':\n\n\t\t\t\t\t\tfixCoords( data, -1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'scale':\n\n\t\t\t\t\t\tfixCoords( data, 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t} else if ( this.strideOut === 4 && type === 'matrix' ) {\n\n\t\t\t\tfixCoords( data, -1 );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tdata = this.output[ ndx ];\n\n\t\t\tif ( member && type === 'translate' ) {\n\t\t\t\tdata = getConvertedTranslation( member, data );\n\t\t\t}\n\n\t\t}\n\n\t\treturn data;\n\n\t};\n\n\tfunction Key ( time ) {\n\n\t\tthis.targets = [];\n\t\tthis.time = time;\n\n\t}\n\n\tKey.prototype.addTarget = function ( fullSid, transform, member, data ) {\n\n\t\tthis.targets.push( {\n\t\t\tsid: fullSid,\n\t\t\tmember: member,\n\t\t\ttransform: transform,\n\t\t\tdata: data\n\t\t} );\n\n\t};\n\n\tKey.prototype.apply = function ( opt_sid ) {\n\n\t\tfor ( var i = 0; i < this.targets.length; ++ i ) {\n\n\t\t\tvar target = this.targets[ i ];\n\n\t\t\tif ( !opt_sid || target.sid === opt_sid ) {\n\n\t\t\t\ttarget.transform.update( target.data, target.member );\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tKey.prototype.getTarget = function ( fullSid ) {\n\n\t\tfor ( var i = 0; i < this.targets.length; ++ i ) {\n\n\t\t\tif ( this.targets[ i ].sid === fullSid ) {\n\n\t\t\t\treturn this.targets[ i ];\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn null;\n\n\t};\n\n\tKey.prototype.hasTarget = function ( fullSid ) {\n\n\t\tfor ( var i = 0; i < this.targets.length; ++ i ) {\n\n\t\t\tif ( this.targets[ i ].sid === fullSid ) {\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn false;\n\n\t};\n\n\t// TODO: Currently only doing linear interpolation. Should support full COLLADA spec.\n\tKey.prototype.interpolate = function ( nextKey, time ) {\n\n\t\tfor ( var i = 0, l = this.targets.length; i < l; i ++ ) {\n\n\t\t\tvar target = this.targets[ i ],\n\t\t\t\tnextTarget = nextKey.getTarget( target.sid ),\n\t\t\t\tdata;\n\n\t\t\tif ( target.transform.type !== 'matrix' && nextTarget ) {\n\n\t\t\t\tvar scale = ( time - this.time ) / ( nextKey.time - this.time ),\n\t\t\t\t\tnextData = nextTarget.data,\n\t\t\t\t\tprevData = target.data;\n\n\t\t\t\tif ( scale < 0 ) scale = 0;\n\t\t\t\tif ( scale > 1 ) scale = 1;\n\n\t\t\t\tif ( prevData.length ) {\n\n\t\t\t\t\tdata = [];\n\n\t\t\t\t\tfor ( var j = 0; j < prevData.length; ++ j ) {\n\n\t\t\t\t\t\tdata[ j ] = prevData[ j ] + ( nextData[ j ] - prevData[ j ] ) * scale;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdata = prevData + ( nextData - prevData ) * scale;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tdata = target.data;\n\n\t\t\t}\n\n\t\t\ttarget.transform.update( data, target.member );\n\n\t\t}\n\n\t};\n\n\t// Camera\n\tfunction Camera() {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.technique = \"\";\n\n\t}\n\n\tCamera.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.name = element.getAttribute( 'name' );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'optics':\n\n\t\t\t\t\tthis.parseOptics( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tCamera.prototype.parseOptics = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tif ( element.childNodes[ i ].nodeName === 'technique_common' ) {\n\n\t\t\t\tvar technique = element.childNodes[ i ];\n\n\t\t\t\tfor ( var j = 0; j < technique.childNodes.length; j ++ ) {\n\n\t\t\t\t\tthis.technique = technique.childNodes[ j ].nodeName;\n\n\t\t\t\t\tif ( this.technique === 'perspective' ) {\n\n\t\t\t\t\t\tvar perspective = technique.childNodes[ j ];\n\n\t\t\t\t\t\tfor ( var k = 0; k < perspective.childNodes.length; k ++ ) {\n\n\t\t\t\t\t\t\tvar param = perspective.childNodes[ k ];\n\n\t\t\t\t\t\t\tswitch ( param.nodeName ) {\n\n\t\t\t\t\t\t\t\tcase 'yfov':\n\t\t\t\t\t\t\t\t\tthis.yfov = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'xfov':\n\t\t\t\t\t\t\t\t\tthis.xfov = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'znear':\n\t\t\t\t\t\t\t\t\tthis.znear = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'zfar':\n\t\t\t\t\t\t\t\t\tthis.zfar = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'aspect_ratio':\n\t\t\t\t\t\t\t\t\tthis.aspect_ratio = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( this.technique === 'orthographic' ) {\n\n\t\t\t\t\t\tvar orthographic = technique.childNodes[ j ];\n\n\t\t\t\t\t\tfor ( var k = 0; k < orthographic.childNodes.length; k ++ ) {\n\n\t\t\t\t\t\t\tvar param = orthographic.childNodes[ k ];\n\n\t\t\t\t\t\t\tswitch ( param.nodeName ) {\n\n\t\t\t\t\t\t\t\tcase 'xmag':\n\t\t\t\t\t\t\t\t\tthis.xmag = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'ymag':\n\t\t\t\t\t\t\t\t\tthis.ymag = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'znear':\n\t\t\t\t\t\t\t\t\tthis.znear = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'zfar':\n\t\t\t\t\t\t\t\t\tthis.zfar = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'aspect_ratio':\n\t\t\t\t\t\t\t\t\tthis.aspect_ratio = param.textContent;\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction InstanceCamera() {\n\n\t\tthis.url = \"\";\n\n\t}\n\n\tInstanceCamera.prototype.parse = function ( element ) {\n\n\t\tthis.url = element.getAttribute('url').replace(/^#/, '');\n\n\t\treturn this;\n\n\t};\n\n\t// Light\n\n\tfunction Light() {\n\n\t\tthis.id = \"\";\n\t\tthis.name = \"\";\n\t\tthis.technique = \"\";\n\n\t}\n\n\tLight.prototype.parse = function ( element ) {\n\n\t\tthis.id = element.getAttribute( 'id' );\n\t\tthis.name = element.getAttribute( 'name' );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'technique_common':\n\n\t\t\t\t\tthis.parseCommon( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'technique':\n\n\t\t\t\t\tthis.parseTechnique( child );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tLight.prototype.parseCommon = function ( element ) {\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tswitch ( element.childNodes[ i ].nodeName ) {\n\n\t\t\t\tcase 'directional':\n\t\t\t\tcase 'point':\n\t\t\t\tcase 'spot':\n\t\t\t\tcase 'ambient':\n\n\t\t\t\t\tthis.technique = element.childNodes[ i ].nodeName;\n\n\t\t\t\t\tvar light = element.childNodes[ i ];\n\n\t\t\t\t\tfor ( var j = 0; j < light.childNodes.length; j ++ ) {\n\n\t\t\t\t\t\tvar child = light.childNodes[j];\n\n\t\t\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\t\t\tcase 'color':\n\n\t\t\t\t\t\t\t\tvar rgba = _floats( child.textContent );\n\t\t\t\t\t\t\t\tthis.color = new THREE.Color(0);\n\t\t\t\t\t\t\t\tthis.color.setRGB( rgba[0], rgba[1], rgba[2] );\n\t\t\t\t\t\t\t\tthis.color.a = rgba[3];\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'falloff_angle':\n\n\t\t\t\t\t\t\t\tthis.falloff_angle = parseFloat( child.textContent );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'quadratic_attenuation':\n\t\t\t\t\t\t\t\tvar f = parseFloat( child.textContent );\n\t\t\t\t\t\t\t\tthis.distance = f ? Math.sqrt( 1 / f ) : 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tLight.prototype.parseTechnique = function ( element ) {\n\n\t\tthis.profile = element.getAttribute( 'profile' );\n\n\t\tfor ( var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'intensity':\n\n\t\t\t\t\tthis.intensity = parseFloat(child.textContent);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction InstanceLight() {\n\n\t\tthis.url = \"\";\n\n\t}\n\n\tInstanceLight.prototype.parse = function ( element ) {\n\n\t\tthis.url = element.getAttribute('url').replace(/^#/, '');\n\n\t\treturn this;\n\n\t};\n\n\tfunction KinematicsModel( ) {\n\n\t\tthis.id = '';\n\t\tthis.name = '';\n\t\tthis.joints = [];\n\t\tthis.links = [];\n\n\t}\n\n\tKinematicsModel.prototype.parse = function( element ) {\n\n\t\tthis.id = element.getAttribute('id');\n\t\tthis.name = element.getAttribute('name');\n\t\tthis.joints = [];\n\t\tthis.links = [];\n\n\t\tfor (var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'technique_common':\n\n\t\t\t\t\tthis.parseCommon(child);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tKinematicsModel.prototype.parseCommon = function( element ) {\n\n\t\tfor (var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( element.childNodes[ i ].nodeName ) {\n\n\t\t\t\tcase 'joint':\n\t\t\t\t\tthis.joints.push( (new Joint()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'link':\n\t\t\t\t\tthis.links.push( (new Link()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Joint( ) {\n\n\t\tthis.sid = '';\n\t\tthis.name = '';\n\t\tthis.axis = new THREE.Vector3();\n\t\tthis.limits = {\n\t\t\tmin: 0,\n\t\t\tmax: 0\n\t\t};\n\t\tthis.type = '';\n\t\tthis.static = false;\n\t\tthis.zeroPosition = 0.0;\n\t\tthis.middlePosition = 0.0;\n\n\t}\n\n\tJoint.prototype.parse = function( element ) {\n\n\t\tthis.sid = element.getAttribute('sid');\n\t\tthis.name = element.getAttribute('name');\n\t\tthis.axis = new THREE.Vector3();\n\t\tthis.limits = {\n\t\t\tmin: 0,\n\t\t\tmax: 0\n\t\t};\n\t\tthis.type = '';\n\t\tthis.static = false;\n\t\tthis.zeroPosition = 0.0;\n\t\tthis.middlePosition = 0.0;\n\n\t\tvar axisElement = element.querySelector('axis');\n\t\tvar _axis = _floats(axisElement.textContent);\n\t\tthis.axis = getConvertedVec3(_axis, 0);\n\n\t\tvar min = element.querySelector('limits min') ? parseFloat(element.querySelector('limits min').textContent) : -360;\n\t\tvar max = element.querySelector('limits max') ? parseFloat(element.querySelector('limits max').textContent) : 360;\n\n\t\tthis.limits = {\n\t\t\tmin: min,\n\t\t\tmax: max\n\t\t};\n\n\t\tvar jointTypes = [ 'prismatic', 'revolute' ];\n\t\tfor (var i = 0; i < jointTypes.length; i ++ ) {\n\n\t\t\tvar type = jointTypes[ i ];\n\n\t\t\tvar jointElement = element.querySelector(type);\n\n\t\t\tif ( jointElement ) {\n\n\t\t\t\tthis.type = type;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// if the min is equal to or somehow greater than the max, consider the joint static\n\t\tif ( this.limits.min >= this.limits.max ) {\n\n\t\t\tthis.static = true;\n\n\t\t}\n\n\t\tthis.middlePosition = (this.limits.min + this.limits.max) / 2.0;\n\t\treturn this;\n\n\t};\n\n\tfunction Link( ) {\n\n\t\tthis.sid = '';\n\t\tthis.name = '';\n\t\tthis.transforms = [];\n\t\tthis.attachments = [];\n\n\t}\n\n\tLink.prototype.parse = function( element ) {\n\n\t\tthis.sid = element.getAttribute('sid');\n\t\tthis.name = element.getAttribute('name');\n\t\tthis.transforms = [];\n\t\tthis.attachments = [];\n\n\t\tfor (var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'attachment_full':\n\t\t\t\t\tthis.attachments.push( (new Attachment()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\tcase 'translate':\n\t\t\t\tcase 'matrix':\n\n\t\t\t\t\tthis.transforms.push( (new Transform()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction Attachment( ) {\n\n\t\tthis.joint = '';\n\t\tthis.transforms = [];\n\t\tthis.links = [];\n\n\t}\n\n\tAttachment.prototype.parse = function( element ) {\n\n\t\tthis.joint = element.getAttribute('joint').split('/').pop();\n\t\tthis.links = [];\n\n\t\tfor (var i = 0; i < element.childNodes.length; i ++ ) {\n\n\t\t\tvar child = element.childNodes[ i ];\n\t\t\tif ( child.nodeType != 1 ) continue;\n\n\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\tcase 'link':\n\t\t\t\t\tthis.links.push( (new Link()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\tcase 'translate':\n\t\t\t\tcase 'matrix':\n\n\t\t\t\t\tthis.transforms.push( (new Transform()).parse(child) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tfunction _source( element ) {\n\n\t\tvar id = element.getAttribute( 'id' );\n\n\t\tif ( sources[ id ] != undefined ) {\n\n\t\t\treturn sources[ id ];\n\n\t\t}\n\n\t\tsources[ id ] = ( new Source(id )).parse( element );\n\t\treturn sources[ id ];\n\n\t}\n\n\tfunction _nsResolver( nsPrefix ) {\n\n\t\tif ( nsPrefix === \"dae\" ) {\n\n\t\t\treturn \"http://www.collada.org/2005/11/COLLADASchema\";\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\tfunction _bools( str ) {\n\n\t\tvar raw = _strings( str );\n\t\tvar data = [];\n\n\t\tfor ( var i = 0, l = raw.length; i < l; i ++ ) {\n\n\t\t\tdata.push( (raw[i] === 'true' || raw[i] === '1') ? true : false );\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tfunction _floats( str ) {\n\n\t\tvar raw = _strings(str);\n\t\tvar data = [];\n\n\t\tfor ( var i = 0, l = raw.length; i < l; i ++ ) {\n\n\t\t\tdata.push( parseFloat( raw[ i ] ) );\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tfunction _ints( str ) {\n\n\t\tvar raw = _strings( str );\n\t\tvar data = [];\n\n\t\tfor ( var i = 0, l = raw.length; i < l; i ++ ) {\n\n\t\t\tdata.push( parseInt( raw[ i ], 10 ) );\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tfunction _strings( str ) {\n\n\t\treturn ( str.length > 0 ) ? _trimString( str ).split( /\\s+/ ) : [];\n\n\t}\n\n\tfunction _trimString( str ) {\n\n\t\treturn str.replace( /^\\s+/, \"\" ).replace( /\\s+$/, \"\" );\n\n\t}\n\n\tfunction _attr_as_float( element, name, defaultValue ) {\n\n\t\tif ( element.hasAttribute( name ) ) {\n\n\t\t\treturn parseFloat( element.getAttribute( name ) );\n\n\t\t} else {\n\n\t\t\treturn defaultValue;\n\n\t\t}\n\n\t}\n\n\tfunction _attr_as_int( element, name, defaultValue ) {\n\n\t\tif ( element.hasAttribute( name ) ) {\n\n\t\t\treturn parseInt( element.getAttribute( name ), 10) ;\n\n\t\t} else {\n\n\t\t\treturn defaultValue;\n\n\t\t}\n\n\t}\n\n\tfunction _attr_as_string( element, name, defaultValue ) {\n\n\t\tif ( element.hasAttribute( name ) ) {\n\n\t\t\treturn element.getAttribute( name );\n\n\t\t} else {\n\n\t\t\treturn defaultValue;\n\n\t\t}\n\n\t}\n\n\tfunction _format_float( f, num ) {\n\n\t\tif ( f === undefined ) {\n\n\t\t\tvar s = '0.';\n\n\t\t\twhile ( s.length < num + 2 ) {\n\n\t\t\t\ts += '0';\n\n\t\t\t}\n\n\t\t\treturn s;\n\n\t\t}\n\n\t\tnum = num || 2;\n\n\t\tvar parts = f.toString().split( '.' );\n\t\tparts[ 1 ] = parts.length > 1 ? parts[ 1 ].substr( 0, num ) : \"0\";\n\n\t\twhile ( parts[ 1 ].length < num ) {\n\n\t\t\tparts[ 1 ] += '0';\n\n\t\t}\n\n\t\treturn parts.join( '.' );\n\n\t}\n\n\tfunction loadTextureImage ( texture, url ) {\n\n\t\tvar loader = new THREE.ImageLoader();\n\n\t\tloader.load( url, function ( image ) {\n\n\t\t\ttexture.image = image;\n\t\t\ttexture.needsUpdate = true;\n\n\t\t} );\n\n\t}\n\n\tfunction extractDoubleSided( obj, element ) {\n\n\t\tobj.doubleSided = false;\n\n\t\tvar node = element.querySelectorAll('extra double_sided')[0];\n\n\t\tif ( node ) {\n\n\t\t\tif ( node && parseInt( node.textContent, 10 ) === 1 ) {\n\n\t\t\t\tobj.doubleSided = true;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// Up axis conversion\n\n\tfunction setUpConversion() {\n\n\t\tif ( options.convertUpAxis !== true || colladaUp === options.upAxis ) {\n\n\t\t\tupConversion = null;\n\n\t\t} else {\n\n\t\t\tswitch ( colladaUp ) {\n\n\t\t\t\tcase 'X':\n\n\t\t\t\t\tupConversion = options.upAxis === 'Y' ? 'XtoY' : 'XtoZ';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Y':\n\n\t\t\t\t\tupConversion = options.upAxis === 'X' ? 'YtoX' : 'YtoZ';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Z':\n\n\t\t\t\t\tupConversion = options.upAxis === 'X' ? 'ZtoX' : 'ZtoY';\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction fixCoords( data, sign ) {\n\n\t\tif ( options.convertUpAxis !== true || colladaUp === options.upAxis ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tswitch ( upConversion ) {\n\n\t\t\tcase 'XtoY':\n\n\t\t\t\tvar tmp = data[ 0 ];\n\t\t\t\tdata[ 0 ] = sign * data[ 1 ];\n\t\t\t\tdata[ 1 ] = tmp;\n\t\t\t\tbreak;\n\n\t\t\tcase 'XtoZ':\n\n\t\t\t\tvar tmp = data[ 2 ];\n\t\t\t\tdata[ 2 ] = data[ 1 ];\n\t\t\t\tdata[ 1 ] = data[ 0 ];\n\t\t\t\tdata[ 0 ] = tmp;\n\t\t\t\tbreak;\n\n\t\t\tcase 'YtoX':\n\n\t\t\t\tvar tmp = data[ 0 ];\n\t\t\t\tdata[ 0 ] = data[ 1 ];\n\t\t\t\tdata[ 1 ] = sign * tmp;\n\t\t\t\tbreak;\n\n\t\t\tcase 'YtoZ':\n\n\t\t\t\tvar tmp = data[ 1 ];\n\t\t\t\tdata[ 1 ] = sign * data[ 2 ];\n\t\t\t\tdata[ 2 ] = tmp;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZtoX':\n\n\t\t\t\tvar tmp = data[ 0 ];\n\t\t\t\tdata[ 0 ] = data[ 1 ];\n\t\t\t\tdata[ 1 ] = data[ 2 ];\n\t\t\t\tdata[ 2 ] = tmp;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZtoY':\n\n\t\t\t\tvar tmp = data[ 1 ];\n\t\t\t\tdata[ 1 ] = data[ 2 ];\n\t\t\t\tdata[ 2 ] = sign * tmp;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction getConvertedTranslation( axis, data ) {\n\n\t\tif ( options.convertUpAxis !== true || colladaUp === options.upAxis ) {\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tswitch ( axis ) {\n\t\t\tcase 'X':\n\t\t\t\tdata = upConversion === 'XtoY' ? data * -1 : data;\n\t\t\t\tbreak;\n\t\t\tcase 'Y':\n\t\t\t\tdata = upConversion === 'YtoZ' || upConversion === 'YtoX' ? data * -1 : data;\n\t\t\t\tbreak;\n\t\t\tcase 'Z':\n\t\t\t\tdata = upConversion === 'ZtoY' ? data * -1 : data ;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tfunction getConvertedVec3( data, offset ) {\n\n\t\tvar arr = [ data[ offset ], data[ offset + 1 ], data[ offset + 2 ] ];\n\t\tfixCoords( arr, -1 );\n\t\treturn new THREE.Vector3( arr[ 0 ], arr[ 1 ], arr[ 2 ] );\n\n\t}\n\n\tfunction getConvertedMat4( data ) {\n\n\t\tif ( options.convertUpAxis ) {\n\n\t\t\t// First fix rotation and scale\n\n\t\t\t// Columns first\n\t\t\tvar arr = [ data[ 0 ], data[ 4 ], data[ 8 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 0 ] = arr[ 0 ];\n\t\t\tdata[ 4 ] = arr[ 1 ];\n\t\t\tdata[ 8 ] = arr[ 2 ];\n\t\t\tarr = [ data[ 1 ], data[ 5 ], data[ 9 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 1 ] = arr[ 0 ];\n\t\t\tdata[ 5 ] = arr[ 1 ];\n\t\t\tdata[ 9 ] = arr[ 2 ];\n\t\t\tarr = [ data[ 2 ], data[ 6 ], data[ 10 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 2 ] = arr[ 0 ];\n\t\t\tdata[ 6 ] = arr[ 1 ];\n\t\t\tdata[ 10 ] = arr[ 2 ];\n\t\t\t// Rows second\n\t\t\tarr = [ data[ 0 ], data[ 1 ], data[ 2 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 0 ] = arr[ 0 ];\n\t\t\tdata[ 1 ] = arr[ 1 ];\n\t\t\tdata[ 2 ] = arr[ 2 ];\n\t\t\tarr = [ data[ 4 ], data[ 5 ], data[ 6 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 4 ] = arr[ 0 ];\n\t\t\tdata[ 5 ] = arr[ 1 ];\n\t\t\tdata[ 6 ] = arr[ 2 ];\n\t\t\tarr = [ data[ 8 ], data[ 9 ], data[ 10 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 8 ] = arr[ 0 ];\n\t\t\tdata[ 9 ] = arr[ 1 ];\n\t\t\tdata[ 10 ] = arr[ 2 ];\n\n\t\t\t// Now fix translation\n\t\t\tarr = [ data[ 3 ], data[ 7 ], data[ 11 ] ];\n\t\t\tfixCoords( arr, -1 );\n\t\t\tdata[ 3 ] = arr[ 0 ];\n\t\t\tdata[ 7 ] = arr[ 1 ];\n\t\t\tdata[ 11 ] = arr[ 2 ];\n\n\t\t}\n\n\t\treturn new THREE.Matrix4().set(\n\t\t\tdata[0], data[1], data[2], data[3],\n\t\t\tdata[4], data[5], data[6], data[7],\n\t\t\tdata[8], data[9], data[10], data[11],\n\t\t\tdata[12], data[13], data[14], data[15]\n\t\t\t);\n\n\t}\n\n\tfunction getConvertedIndex( index ) {\n\n\t\tif ( index > -1 && index < 3 ) {\n\n\t\t\tvar members = [ 'X', 'Y', 'Z' ],\n\t\t\t\tindices = { X: 0, Y: 1, Z: 2 };\n\n\t\t\tindex = getConvertedMember( members[ index ] );\n\t\t\tindex = indices[ index ];\n\n\t\t}\n\n\t\treturn index;\n\n\t}\n\n\tfunction getConvertedMember( member ) {\n\n\t\tif ( options.convertUpAxis ) {\n\n\t\t\tswitch ( member ) {\n\n\t\t\t\tcase 'X':\n\n\t\t\t\t\tswitch ( upConversion ) {\n\n\t\t\t\t\t\tcase 'XtoY':\n\t\t\t\t\t\tcase 'XtoZ':\n\t\t\t\t\t\tcase 'YtoX':\n\n\t\t\t\t\t\t\tmember = 'Y';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'ZtoX':\n\n\t\t\t\t\t\t\tmember = 'Z';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Y':\n\n\t\t\t\t\tswitch ( upConversion ) {\n\n\t\t\t\t\t\tcase 'XtoY':\n\t\t\t\t\t\tcase 'YtoX':\n\t\t\t\t\t\tcase 'ZtoX':\n\n\t\t\t\t\t\t\tmember = 'X';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'XtoZ':\n\t\t\t\t\t\tcase 'YtoZ':\n\t\t\t\t\t\tcase 'ZtoY':\n\n\t\t\t\t\t\t\tmember = 'Z';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Z':\n\n\t\t\t\t\tswitch ( upConversion ) {\n\n\t\t\t\t\t\tcase 'XtoZ':\n\n\t\t\t\t\t\t\tmember = 'X';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'YtoZ':\n\t\t\t\t\t\tcase 'ZtoX':\n\t\t\t\t\t\tcase 'ZtoY':\n\n\t\t\t\t\t\t\tmember = 'Y';\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn member;\n\n\t}\n\n\treturn {\n\n\t\tload: load,\n\t\tparse: parse,\n\t\tsetPreferredShading: setPreferredShading,\n\t\tapplySkin: applySkin,\n\t\tgeometries : geometries,\n\t\toptions: options\n\n\t};\n\n};\n"]}